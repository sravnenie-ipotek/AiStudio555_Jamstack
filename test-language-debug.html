<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Debug Simple Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f5f5f5;
        }

        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 800px;
        }

        .lang-pills {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .lang-pill {
            padding: 8px 16px;
            border-radius: 20px;
            background: transparent;
            color: #007bff;
            border: 1px solid #007bff;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
        }

        .lang-pill:hover {
            background: #007bff;
            color: white;
        }

        .lang-pill.active {
            background: #ffd700;
            color: #1a1d3a;
            border-color: #ffd700;
        }

        .status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }

        .error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔧 Language Toggle Debug</h1>

        <h2>Test Pills (Should switch language)</h2>
        <div class="lang-pills">
            <a href="#" class="lang-pill active" onclick="setActivePill(this)">EN</a>
            <a href="#" class="lang-pill" onclick="setActivePill(this)">RU</a>
            <a href="#" class="lang-pill" onclick="setActivePill(this)">HE</a>
        </div>

        <div id="status" class="status">
            Click a language pill to test functionality...
        </div>

        <h2>Debug Information</h2>
        <div id="debug-info">
            <p><strong>Page URL:</strong> <span id="current-url"></span></p>
            <p><strong>HTML Lang:</strong> <span id="html-lang"></span></p>
            <p><strong>HTML Dir:</strong> <span id="html-dir"></span></p>
            <p><strong>Language Manager:</strong> <span id="lang-manager-status">Checking...</span></p>
            <p><strong>setActivePill Function:</strong> <span id="function-status">Checking...</span></p>
            <p><strong>API Status:</strong> <span id="api-status">Checking...</span></p>
        </div>

        <h2>Console Log</h2>
        <div id="console-log" style="background: #000; color: #0f0; padding: 15px; font-family: monospace; height: 200px; overflow-y: auto; border-radius: 4px;">
        </div>
    </div>

    <script>
        // Capture console messages
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function logToDiv(message, type = 'log') {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            logToDiv(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            logToDiv(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToDiv(args.join(' '), 'warn');
        };

        // Update debug info
        function updateDebugInfo() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('html-lang').textContent = document.documentElement.getAttribute('lang') || 'not set';
            document.getElementById('html-dir').textContent = document.documentElement.getAttribute('dir') || 'not set';
        }

        function checkLanguageManager() {
            if (window.languageManager) {
                document.getElementById('lang-manager-status').textContent = '✅ Loaded';
                document.getElementById('lang-manager-status').style.color = 'green';
                console.log('Language Manager found:', window.languageManager);
            } else {
                document.getElementById('lang-manager-status').textContent = '❌ Not found';
                document.getElementById('lang-manager-status').style.color = 'red';
                console.error('Language Manager not found');
            }
        }

        function checkSetActivePillFunction() {
            if (typeof window.setActivePill === 'function') {
                document.getElementById('function-status').textContent = '✅ Available';
                document.getElementById('function-status').style.color = 'green';
                console.log('setActivePill function:', window.setActivePill.toString().substring(0, 100) + '...');
            } else {
                document.getElementById('function-status').textContent = '❌ Not found';
                document.getElementById('function-status').style.color = 'red';
                console.error('setActivePill function not found');
            }
        }

        async function checkAPIStatus() {
            try {
                const response = await fetch('http://localhost:1337/api/nd/home-page?locale=en');
                if (response.ok) {
                    document.getElementById('api-status').textContent = '✅ Working';
                    document.getElementById('api-status').style.color = 'green';
                    console.log('API is working');
                } else {
                    document.getElementById('api-status').textContent = `❌ Error ${response.status}`;
                    document.getElementById('api-status').style.color = 'red';
                    console.error('API error:', response.status);
                }
            } catch (error) {
                document.getElementById('api-status').textContent = '❌ Network error';
                document.getElementById('api-status').style.color = 'red';
                console.error('API network error:', error);
            }
        }

        // Define a test setActivePill function if none exists
        if (typeof setActivePill === 'undefined') {
            console.log('Defining test setActivePill function');

            window.setActivePill = function(element) {
                console.log('setActivePill called with:', element.textContent);

                const status = document.getElementById('status');
                status.className = 'status success';
                status.textContent = `Language switched to: ${element.textContent} (Test function - no actual language change)`;

                // Update visual state
                document.querySelectorAll('.lang-pill').forEach(pill => {
                    pill.classList.remove('active');
                });
                element.classList.add('active');

                updateDebugInfo();
            };
        }

        // Run checks when page loads
        window.addEventListener('load', function() {
            updateDebugInfo();
            checkLanguageManager();
            checkSetActivePillFunction();
            checkAPIStatus();

            console.log('Debug page loaded');
            console.log('Testing if we can detect the language manager...');

            // Check if language manager loads later
            setTimeout(() => {
                checkLanguageManager();
                checkSetActivePillFunction();
            }, 2000);
        });

        // Log any errors
        window.addEventListener('error', function(event) {
            console.error('JavaScript error:', event.error);
        });
    </script>

    <!-- Load the language manager script -->
    <script src="js/language-manager.js"></script>
</body>
</html>