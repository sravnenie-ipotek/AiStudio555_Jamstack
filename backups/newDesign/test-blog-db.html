<!DOCTYPE html>
<html>
<head>
    <title>Test Blog Database Connection</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .blog-post { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Blog Database Connection Test</h1>
    <div id="status"></div>
    <div id="posts"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const postsDiv = document.getElementById('posts');

        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            statusDiv.appendChild(div);
        }

        async function testBlogConnection() {
            // Check which server is running
            const apiUrl = 'http://localhost:3000/api/blog-posts';

            addStatus(`Testing API endpoint: ${apiUrl}`);

            try {
                const response = await fetch(apiUrl);
                addStatus(`Response status: ${response.status}`, response.ok ? 'success' : 'error');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Raw API response:', data);

                // Check response structure
                if (data.success && data.data) {
                    addStatus(`Found ${data.data.length} blog posts in database`, 'success');

                    // Display posts
                    data.data.forEach(post => {
                        const postDiv = document.createElement('div');
                        postDiv.className = 'blog-post';
                        postDiv.innerHTML = `
                            <h3>${post.title}</h3>
                            <p><strong>Author:</strong> ${post.author}</p>
                            <p><strong>Excerpt:</strong> ${post.excerpt}</p>
                            <p><strong>Category:</strong> ${post.category || 'Not set'}</p>
                            <p><strong>Published:</strong> ${new Date(post.published_at).toLocaleDateString()}</p>
                            <p><strong>ID:</strong> ${post.id}</p>
                        `;
                        postsDiv.appendChild(postDiv);
                    });

                    // Now test if blog-integration.js would work
                    addStatus('Testing blog-integration.js logic...', 'info');

                    // Simulate what blog-integration.js does
                    const container = document.createElement('div');
                    container.className = 'main-blog-collection-list';
                    document.body.appendChild(container);

                    // Load the actual blog-integration.js
                    const script = document.createElement('script');
                    script.src = 'js/blog-integration.js';
                    script.onload = () => {
                        addStatus('blog-integration.js loaded successfully', 'success');
                    };
                    script.onerror = () => {
                        addStatus('Failed to load blog-integration.js', 'error');
                    };
                    document.body.appendChild(script);

                } else {
                    addStatus('Unexpected response structure', 'error');
                    console.error('Response:', data);
                }

            } catch (error) {
                addStatus(`Error: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        // Run test when page loads
        testBlogConnection();
    </script>
</body>
</html></content>