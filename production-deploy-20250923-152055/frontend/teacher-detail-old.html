<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Teacher Profile | AI Studio</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/aizeks-groovy-site.webflow.css" rel="stylesheet" type="text/css">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .teacher-detail-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .teacher-header {
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      color: white;
      padding: 60px 40px;
      text-align: center;
    }

    .teacher-avatar-large {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      margin: 0 auto 30px;
      border: 5px solid rgba(255, 255, 255, 0.2);
    }

    .teacher-name-large {
      font-size: 48px;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .teacher-title-large {
      font-size: 24px;
      color: #a0aec0;
      margin-bottom: 10px;
    }

    .teacher-company-large {
      font-size: 18px;
      color: #718096;
    }

    .teacher-content {
      padding: 40px;
    }

    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 28px;
      color: #2d3748;
      margin-bottom: 20px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-number {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .skills-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .skill-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 14px;
    }

    .course-list {
      display: grid;
      gap: 20px;
    }

    .course-item {
      background: #f7fafc;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #667eea;
    }

    .course-title {
      font-size: 20px;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .course-stats {
      display: flex;
      gap: 20px;
      color: #718096;
      font-size: 14px;
    }

    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      background: white;
      color: #667eea;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      z-index: 100;
    }

    .back-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .loading {
      text-align: center;
      padding: 100px;
      font-size: 24px;
      color: white;
    }

    .error {
      text-align: center;
      padding: 100px;
      font-size: 20px;
      color: #e53e3e;
      background: white;
      border-radius: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <a href="teachers.html" class="back-button" id="back-button">← Back to Teachers</a>

  <div id="teacher-detail-content">
    <div class="loading">Loading teacher profile...</div>
  </div>

  <script>
    // Get teacher ID and locale from URL
    const urlParams = new URLSearchParams(window.location.search);
    const teacherId = urlParams.get('id');
    const locale = urlParams.get('locale') || 'en';

    // Update back button with locale
    document.getElementById('back-button').href = `teachers.html?locale=${locale}`;

    // API configuration
    const API_BASE_URL = window.location.hostname === 'localhost'
        ? 'http://localhost:3000'
        : 'https://aistudio555jamstack-production.up.railway.app';

    // Avatar service
    const AVATAR_SERVICE_URL = 'https://ui-avatars.com/api/';

    // Generate avatar URL
    function generateAvatarUrl(fullName) {
        const colors = ['667eea', '764ba2', '4facfe', '43e97b', 'f093fb', 'fa709a'];
        const colorIndex = fullName.length % colors.length;
        return `${AVATAR_SERVICE_URL}?name=${encodeURIComponent(fullName)}&size=400&background=${colors[colorIndex]}&color=ffffff&bold=true&font-size=0.4&format=svg`;
    }

    // Load teacher details
    async function loadTeacherDetails() {
        try {
            // Fetch individual teacher data with locale
            const response = await fetch(`${API_BASE_URL}/api/nd/teachers/${teacherId}?locale=${locale}`);
            const data = await response.json();

            if (data.success && data.data) {
                renderTeacherDetail(data.data);
            } else {
                showError('Teacher not found');
            }
        } catch (error) {
            console.error('Error:', error);
            showError('Error loading teacher profile');
        }
    }

    // Get localized text
    function getLocalizedText(key) {
        const translations = {
            en: {
                rating: 'Rating',
                years: 'Years Experience',
                courses: 'Courses',
                students: 'Students',
                about: 'About',
                skills: 'Skills & Expertise',
                experience: 'Experience',
                coursesTaught: 'Courses Taught',
                reviews: 'Student Reviews'
            },
            ru: {
                rating: 'Рейтинг',
                years: 'Лет опыта',
                courses: 'Курсов',
                students: 'Студентов',
                about: 'О преподавателе',
                skills: 'Навыки и экспертиза',
                experience: 'Опыт',
                coursesTaught: 'Преподаваемые курсы',
                reviews: 'Отзывы студентов'
            },
            he: {
                rating: 'דירוג',
                years: 'שנות ניסיון',
                courses: 'קורסים',
                students: 'סטודנטים',
                about: 'אודות',
                skills: 'כישורים ומומחיות',
                experience: 'ניסיון',
                coursesTaught: 'קורסים שנלמדו',
                reviews: 'ביקורות סטודנטים'
            }
        };
        return translations[locale]?.[key] || translations.en[key];
    }

    // Generate professional photo URL
    function generatePhotoUrl(teacher, index = 0) {
        if (teacher.profile_image_url && !teacher.profile_image_url.includes('images/')) {
            return teacher.profile_image_url;
        }

        // Use Unsplash for professional photos
        const unsplashIds = [
            'd1UPkiFd04A', 'WX4i1Jq_o0Y', 'jzY0KRJopEI', 'sibVwORYqs0',
            '2EF8lHdO3Y8', 'rDEOVtE7vOs', 'IF9TK5Uy-KI', '5yENR2BKGQs'
        ];
        const photoId = unsplashIds[index % unsplashIds.length];
        return `https://images.unsplash.com/photo-${photoId}?w=400&h=400&fit=crop&q=80`;
    }

    // Render teacher detail
    function renderTeacherDetail(teacher) {
        // Get localized content
        const teacherName = teacher[`full_name_${locale}`] || teacher.full_name;
        const teacherTitle = teacher[`professional_title_${locale}`] || teacher.professional_title;
        const teacherCompany = teacher[`company_${locale}`] || teacher.company;
        const teacherBio = teacher[`bio_${locale}`] || teacher.bio;

        // Generate photo URL
        const avatarUrl = generatePhotoUrl(teacher, teacher.id || 0);
        const fallbackUrl = generateAvatarUrl(teacherName);

        const container = document.getElementById('teacher-detail-content');
        container.innerHTML = `
            <div class="teacher-detail-container">
                <div class="teacher-header">
                    <img src="${avatarUrl}"
                         alt="${teacherName}"
                         class="teacher-avatar-large"
                         onerror="this.onerror=null; this.src='${fallbackUrl}'">
                    <h1 class="teacher-name-large">${teacherName}</h1>
                    <div class="teacher-title-large">${teacherTitle}</div>
                    <div class="teacher-company-large">${teacherCompany}</div>
                </div>

                <div class="teacher-content">
                    <!-- Statistics -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${teacher.statistics?.rating || '4.8'}</div>
                            <div class="stat-label">${getLocalizedText('rating')} ⭐</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${teacher.statistics?.years_experience || 5}</div>
                            <div class="stat-label">${getLocalizedText('years')}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${teacher.statistics?.courses_count || 0}</div>
                            <div class="stat-label">${getLocalizedText('courses')}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${teacher.statistics?.students_taught || 0}</div>
                            <div class="stat-label">${getLocalizedText('students')}</div>
                        </div>
                    </div>

                    <!-- Bio -->
                    <div class="section">
                        <h2 class="section-title">${getLocalizedText('about')}</h2>
                        <p>${teacherBio}</p>
                    </div>

                    <!-- Skills -->
                    <div class="section">
                        <h2 class="section-title">${getLocalizedText('skills')}</h2>
                        <div class="skills-grid">
                            ${(teacher.skills || []).map(skill =>
                                `<span class="skill-badge">${skill}</span>`
                            ).join('')}
                        </div>
                    </div>

                    <!-- Experience -->
                    ${teacher.experience_history && teacher.experience_history.length > 0 ? `
                        <div class="section">
                            <h2 class="section-title">${getLocalizedText('experience')}</h2>
                            <div class="course-list">
                                ${teacher.experience_history.map(exp => `
                                    <div class="course-item">
                                        <div class="course-title">${exp.title} - ${exp.company}</div>
                                        <div class="course-stats">
                                            <span>📅 ${exp.duration}</span>
                                        </div>
                                        <p>${exp.description}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Courses -->
                    ${teacher.courses_taught && teacher.courses_taught.length > 0 ? `
                        <div class="section">
                            <h2 class="section-title">${getLocalizedText('coursesTaught')}</h2>
                            <div class="course-list">
                                ${teacher.courses_taught.map(course => `
                                    <div class="course-item">
                                        <div class="course-title">${course.title}</div>
                                        <div class="course-stats">
                                            <span>⭐ ${course.rating}</span>
                                            <span>👥 ${course.students} ${getLocalizedText('students').toLowerCase()}</span>
                                        </div>
                                        <p>${course.description}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Reviews -->
                    ${teacher.student_reviews && teacher.student_reviews.length > 0 ? `
                        <div class="section">
                            <h2 class="section-title">${getLocalizedText('reviews')}</h2>
                            <div class="course-list">
                                ${teacher.student_reviews.map(review => `
                                    <div class="course-item">
                                        <div class="course-stats">
                                            <span>${review.stars}</span>
                                            <span>- ${review.author}</span>
                                        </div>
                                        <p>"${review.text}"</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
    }

    // Show error message
    function showError(message) {
        document.getElementById('teacher-detail-content').innerHTML = `
            <div class="error">${message}</div>
        `;
    }

    // Load teacher details on page load
    if (teacherId) {
        loadTeacherDetails();
    } else {
        showError('No teacher ID provided');
    }
  </script>
</body>
</html>