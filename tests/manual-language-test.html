<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Switching Manual Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .test-section h2 {
            color: #667eea;
            margin-top: 0;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button.success {
            background: #48bb78;
        }

        button.error {
            background: #f56565;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            background: #c6f6d5;
            border: 1px solid #48bb78;
            color: #22543d;
        }

        .result.error {
            background: #fed7d7;
            border: 1px solid #f56565;
            color: #742a2a;
        }

        .result.info {
            background: #e6fffa;
            border: 1px solid #4fd1c5;
            color: #234e52;
        }

        .result.warning {
            background: #fefcbf;
            border: 1px solid #f6e05e;
            color: #744210;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.active {
            background: #48bb78;
        }

        .status-indicator.inactive {
            background: #cbd5e0;
        }

        .status-indicator.error {
            background: #f56565;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .test-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }

        .test-card h3 {
            margin-top: 0;
            color: #4a5568;
            font-size: 16px;
        }

        .iframe-container {
            width: 100%;
            height: 600px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-top: 20px;
            overflow: hidden;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .language-pills {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .lang-pill {
            padding: 8px 16px;
            border-radius: 20px;
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lang-pill:hover {
            background: #667eea;
            color: white;
        }

        .lang-pill.active {
            background: #ffd700;
            color: #1a1d3a;
            border-color: #ffd700;
        }

        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
            color: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Language Switching Manual Test Suite</h1>

        <div class="test-section">
            <h2>
                <span class="status-indicator active"></span>
                Test Configuration
            </h2>
            <p>Testing the AI Studio language switching functionality</p>
            <div class="test-grid">
                <div class="test-card">
                    <h3>API Status</h3>
                    <button onclick="checkAPIStatus()">Check API</button>
                    <div id="api-status"></div>
                </div>
                <div class="test-card">
                    <h3>Frontend Server</h3>
                    <button onclick="checkFrontend()">Check Frontend</button>
                    <div id="frontend-status"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Language Tests</h2>
            <p>Click each button to test specific language functionality:</p>

            <button onclick="testLanguageAPI('en')">Test English API</button>
            <button onclick="testLanguageAPI('ru')">Test Russian API</button>
            <button onclick="testLanguageAPI('he')">Test Hebrew API</button>
            <button onclick="testAllLanguages()">Test All Languages</button>
            <button onclick="testLanguageFallback()">Test Fallback</button>
            <button onclick="testCaching()">Test Caching</button>

            <div id="language-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üîÑ Live Language Switching Demo</h2>
            <p>Use these pills to switch languages in the iframe below:</p>

            <div class="language-pills">
                <button class="lang-pill active" onclick="switchIframeLanguage('en', this)">EN</button>
                <button class="lang-pill" onclick="switchIframeLanguage('ru', this)">RU</button>
                <button class="lang-pill" onclick="switchIframeLanguage('he', this)">HE</button>
            </div>

            <div class="iframe-container">
                <iframe id="test-frame" src="http://localhost:3005/backups/newDesign/home.html"></iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>üìä Test Results Summary</h2>
            <div id="summary" class="result info" style="display:none;"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:1337';
        const FRONTEND_URL = 'http://localhost:3005/backups/newDesign';
        let testResults = [];

        async function checkAPIStatus() {
            const statusDiv = document.getElementById('api-status');
            try {
                const response = await fetch(`${API_URL}/api/nd/home-page`);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="result success">‚úÖ API is running on port 1337</div>';
                } else {
                    statusDiv.innerHTML = '<div class="result error">‚ùå API returned status: ' + response.status + '</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="result error">‚ùå API is not accessible: ' + error.message + '</div>';
            }
        }

        async function checkFrontend() {
            const statusDiv = document.getElementById('frontend-status');
            try {
                const response = await fetch(`${FRONTEND_URL}/home.html`);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="result success">‚úÖ Frontend is running on port 3005</div>';
                } else {
                    statusDiv.innerHTML = '<div class="result error">‚ùå Frontend returned status: ' + response.status + '</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="result error">‚ùå Frontend is not accessible: ' + error.message + '</div>';
            }
        }

        async function testLanguageAPI(locale) {
            const resultDiv = document.getElementById('language-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = `Testing ${locale.toUpperCase()} language API...`;

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_URL}/api/nd/home-page?locale=${locale}`);
                const loadTime = Date.now() - startTime;

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();

                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>‚úÖ ${locale.toUpperCase()} API Test Passed</strong><br>
                    Load time: ${loadTime}ms<br>
                    Response size: ${JSON.stringify(data).length} bytes<br>
                    Has content: ${data && Object.keys(data).length > 0 ? 'Yes' : 'No'}<br>
                    Sample keys: ${Object.keys(data).slice(0, 5).join(', ')}
                `;

                testResults.push({ test: `API ${locale}`, status: 'pass', time: loadTime });
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ùå ${locale.toUpperCase()} API Test Failed</strong><br>
                    Error: ${error.message}
                `;
                testResults.push({ test: `API ${locale}`, status: 'fail', error: error.message });
            }
        }

        async function testAllLanguages() {
            const locales = ['en', 'ru', 'he'];
            for (const locale of locales) {
                await testLanguageAPI(locale);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            showSummary();
        }

        async function testLanguageFallback() {
            const resultDiv = document.getElementById('language-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = 'Testing language fallback mechanism...';

            try {
                // Test with non-existent locale
                const response = await fetch(`${API_URL}/api/nd/home-page?locale=zh`);
                const data = await response.json();

                // Should fall back to English
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>‚úÖ Fallback Test Passed</strong><br>
                    Non-existent locale (zh) correctly fell back to English<br>
                    Response contains: ${Object.keys(data).length} keys
                `;
                testResults.push({ test: 'Fallback', status: 'pass' });
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ùå Fallback Test Failed</strong><br>
                    Error: ${error.message}
                `;
                testResults.push({ test: 'Fallback', status: 'fail' });
            }
        }

        async function testCaching() {
            const resultDiv = document.getElementById('language-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = 'Testing caching mechanism...';

            try {
                // First request
                const start1 = Date.now();
                await fetch(`${API_URL}/api/nd/home-page?locale=ru`);
                const time1 = Date.now() - start1;

                // Second request (should be faster if cached)
                const start2 = Date.now();
                await fetch(`${API_URL}/api/nd/home-page?locale=ru`);
                const time2 = Date.now() - start2;

                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>‚úÖ Caching Test Completed</strong><br>
                    First request: ${time1}ms<br>
                    Second request: ${time2}ms<br>
                    Speed improvement: ${Math.round((1 - time2/time1) * 100)}%<br>
                    Note: Client-side caching happens in the browser
                `;
                testResults.push({ test: 'Caching', status: 'pass' });
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ùå Caching Test Failed</strong><br>
                    Error: ${error.message}
                `;
                testResults.push({ test: 'Caching', status: 'fail' });
            }
        }

        function switchIframeLanguage(locale, button) {
            // Update active pill
            document.querySelectorAll('.lang-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            button.classList.add('active');

            // Update iframe URL
            const iframe = document.getElementById('test-frame');
            iframe.src = `${FRONTEND_URL}/home.html?locale=${locale}`;

            // Show result
            const resultDiv = document.getElementById('language-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = `Switching to ${locale.toUpperCase()} in iframe...`;

            // Wait for iframe to load
            iframe.onload = () => {
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `‚úÖ Loaded ${locale.toUpperCase()} version`;

                // Try to check if language actually changed in iframe
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const htmlLang = iframeDoc.documentElement.getAttribute('lang');
                    const htmlDir = iframeDoc.documentElement.getAttribute('dir');

                    resultDiv.innerHTML += `<br>HTML lang attribute: <code>${htmlLang || 'not set'}</code>`;
                    resultDiv.innerHTML += `<br>HTML dir attribute: <code>${htmlDir || 'ltr'}</code>`;
                } catch (e) {
                    // Cross-origin restrictions might prevent access
                    resultDiv.innerHTML += '<br><small>Note: Cross-origin restrictions prevent reading iframe content</small>';
                }
            };
        }

        function showSummary() {
            const summaryDiv = document.getElementById('summary');
            summaryDiv.style.display = 'block';

            const passed = testResults.filter(t => t.status === 'pass').length;
            const failed = testResults.filter(t => t.status === 'fail').length;
            const avgTime = testResults
                .filter(t => t.time)
                .reduce((acc, t) => acc + t.time, 0) / testResults.filter(t => t.time).length;

            summaryDiv.innerHTML = `
                <h3>Test Results Summary</h3>
                <strong>Total Tests:</strong> ${testResults.length}<br>
                <strong>Passed:</strong> ${passed} ‚úÖ<br>
                <strong>Failed:</strong> ${failed} ‚ùå<br>
                <strong>Success Rate:</strong> ${Math.round((passed / testResults.length) * 100)}%<br>
                <strong>Average Response Time:</strong> ${Math.round(avgTime || 0)}ms<br>
                <br>
                <strong>Details:</strong><br>
                ${testResults.map(t => `
                    ${t.status === 'pass' ? '‚úÖ' : '‚ùå'} ${t.test}
                    ${t.time ? `(${t.time}ms)` : ''}
                    ${t.error ? `- ${t.error}` : ''}
                `).join('<br>')}
            `;
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            checkAPIStatus();
            checkFrontend();
        });
    </script>
</body>
</html>