<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>Test FAQ Timing Fix</title>
  <link href="css/faq-visibility-fix.css" rel="stylesheet" type="text/css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #050520; color: white; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; }
    .faq-question { color: white; font-size: 18px; font-weight: 600; margin: 10px 0; }
    .faq-answer { color: rgba(255,255,255,0.9); margin: 5px 0; }
    .log { background: #222; padding: 10px; margin: 10px 0; font-family: monospace; }
    .success { color: #0f0; }
    .error { color: #f00; }
  </style>
</head>
<body>

<h1>FAQ Timing Fix Test</h1>

<div class="test-section">
  <h2>Test Results</h2>
  <div id="testResults" class="log">
    Starting test...
  </div>
</div>

<div class="test-section">
  <h2>FAQ Content (Should load after 1.7 seconds)</h2>
  <div class="faq-question" id="faq1">Loading...</div>
  <div class="faq-answer" id="faq1-answer">Loading...</div>
  <div class="faq-question" id="faq2">Loading...</div>
  <div class="faq-answer" id="faq2-answer">Loading...</div>
</div>

<script>
// Test log function
function log(message, type = 'info') {
  const div = document.getElementById('testResults');
  const timestamp = new Date().toLocaleTimeString();
  const color = type === 'success' ? '#0f0' : type === 'error' ? '#f00' : '#fff';
  div.innerHTML += `<div style="color:${color}">[${timestamp}] ${message}</div>`;
}

// Simulate Hebrew translations fix (runs at 1.5s)
setTimeout(() => {
  log('üî∑ Hebrew translations fix would run now', 'info');
}, 1500);

// Our new bulletproof FAQ loading (runs at 1.7s, 2.5s, 3.5s)
const loadFAQContent = (timestamp) => {
  log(`üìù Loading FAQ content at ${timestamp}...`, 'info');

  fetch('http://localhost:3000/api/home-page?locale=he')
    .then(response => response.json())
    .then(data => {
      log(`‚úÖ API response received at ${timestamp}`, 'success');

      // Update FAQ content
      document.getElementById('faq1').textContent = data.faq_1_title || 'Not found';
      document.getElementById('faq1-answer').textContent = data.faq_1_answer || 'Not found';
      document.getElementById('faq2').textContent = data.faq_2_title || 'Not found';
      document.getElementById('faq2-answer').textContent = data.faq_2_answer || 'Not found';

      // Apply bulletproof protection
      document.querySelectorAll('.faq-question, .faq-answer').forEach(el => {
        el.style.cssText = `
          color: #ffffff !important;
          opacity: 1 !important;
          visibility: visible !important;
          font-weight: 600 !important;
        `;
      });

      log(`‚úÖ FAQ content updated and protected at ${timestamp}`, 'success');
      log(`FAQ 1: ${data.faq_1_title}`, 'success');
      log(`FAQ 2: ${data.faq_2_title}`, 'success');
    })
    .catch(error => {
      log(`‚ùå API error at ${timestamp}: ${error.message}`, 'error');
    });
};

// Multiple protective loads
setTimeout(() => loadFAQContent('1.7s'), 1700);
setTimeout(() => {
  log('üõ°Ô∏è Re-protecting FAQ content...', 'info');
  loadFAQContent('2.5s');
}, 2500);
setTimeout(() => {
  log('üõ°Ô∏è Final FAQ protection...', 'info');
  loadFAQContent('3.5s');
}, 3500);

log('Test page loaded - watching for timing...', 'info');
</script>

</body>
</html>