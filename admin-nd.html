<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Design Admin - AI Studio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .header h1 { font-size: 28px; margin-bottom: 5px; }
        .header p { opacity: 0.9; font-size: 14px; }

        /* Language Switcher */
        #admin-language-switcher {
            position: absolute;
            top: 20px;
            right: 200px;
            display: flex !important;
            gap: 8px;
            z-index: 1001;
        }

        .lang-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .lang-btn.active {
            background: rgba(255,255,255,0.9);
            color: #667eea;
            border-color: white;
        }

        /* Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Main Card */
        .admin-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #e1e1e1;
            background: #f8f9fa;
            padding: 0 20px;
        }

        .tab {
            padding: 15px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s;
            position: relative;
            color: #666;
        }

        .tab.active {
            color: #667eea;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.05);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 30px;
        }

        .content-section.active { display: block; }

        /* Form Groups */
        .form-group {
            margin-bottom: 25px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e1e1e1;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s;
            font-family: inherit;
            background: white;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Visibility Toggle */
        .visibility-group {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .visibility-toggle {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .visibility-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .visibility-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 26px;
        }

        .visibility-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        .visibility-toggle input:checked + .visibility-slider {
            background-color: #667eea;
        }

        .visibility-toggle input:checked + .visibility-slider:before {
            transform: translateX(24px);
        }

        /* Dynamic List Manager */
        .list-manager {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .list-item {
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .list-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 15px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #5569d3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-danger { background: #ff3b30; }
        .btn-danger:hover { background: #d12b20; }

        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }

        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* Search Feature Styles */
        .search-container {
            background: white;
            padding: 20px;
            border-bottom: 2px solid #e1e1e1;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
        }

        .search-box input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-result-item:hover {
            background: #e8f4fd;
            transform: translateX(5px);
        }

        .search-result-section {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .search-result-field {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .search-result-value {
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .search-highlight {
            background: #fff59d;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* Preview Mode Banner */
        .preview-banner {
            background: #ffc107;
            color: #000;
            padding: 10px;
            text-align: center;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: none;
        }

        .preview-banner.active {
            display: block;
        }

        /* Toaster */
        .toaster-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
        }

        .toaster {
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            border-left: 4px solid #667eea;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
        }

        .toaster.success { border-left-color: #28a745; }
        .toaster.error { border-left-color: #dc3545; }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Section Headers */
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Preview Banner -->
    <div id="previewBanner" class="preview-banner">
        üîç Preview Mode - Changes are not saved until you click Save
    </div>

    <!-- Header -->
    <div class="header">
        <div id="admin-language-switcher">
            <button class="lang-btn active" data-lang="en">EN</button>
            <button class="lang-btn" data-lang="ru">RU</button>
            <button class="lang-btn" data-lang="he">HE</button>
        </div>
        <h1>üé® New Design Content Manager</h1>
        <p>Manage content for the new design with visibility controls and multi-language support</p>
    </div>

    <!-- Container -->
    <div class="container">
        <div class="admin-card">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="home">Home Page</button>
                <button class="tab" data-tab="courses">Courses</button>
                <button class="tab" data-tab="pricing">Pricing</button>
                <button class="tab" data-tab="teachers">Teachers</button>
                <button class="tab" data-tab="blog">Blog</button>
                <button class="tab" data-tab="menu">Navigation</button>
                <button class="tab" data-tab="footer">Footer</button>
                <button class="tab" data-tab="settings">Settings</button>
            </div>

            <!-- Search Feature -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="adminSearch" placeholder="üîç Search for any content, field, or value across all sections..." />
                    <button class="btn btn-secondary" onclick="clearSearch()">Clear</button>
                </div>
                <div id="searchResults" class="search-results"></div>
            </div>

            <!-- Home Page Section -->
            <div class="content-section active" id="home">
                <div class="section-header">
                    <div class="section-title">Home Page Sections</div>
                    <button class="btn btn-small" onclick="previewChanges()">üëÅÔ∏è Preview</button>
                </div>

                <!-- Hero Section -->
                <div class="form-group">
                    <label>ü¶∏ Hero Section</label>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="hero_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Section Visible</span>
                    </div>

                    <input type="text" id="hero_title" placeholder="Hero Title" class="mb-10">
                    <input type="text" id="hero_subtitle" placeholder="Hero Subtitle" class="mb-10">
                    <textarea id="hero_description" placeholder="Hero Description"></textarea>

                    <!-- Hero Buttons -->
                    <div class="list-manager mt-20">
                        <div class="list-item-header">
                            <strong>Buttons</strong>
                            <button class="btn btn-small btn-success" onclick="addHeroButton()">+ Add Button</button>
                        </div>
                        <div id="heroButtons"></div>
                    </div>
                </div>

                <!-- Features Section -->
                <div class="form-group">
                    <label>‚ú® Features Section</label>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="features_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Section Visible</span>
                    </div>

                    <input type="text" id="features_title" placeholder="Features Title" class="mb-10">
                    <input type="text" id="features_subtitle" placeholder="Features Subtitle" class="mb-10">

                    <div class="list-manager mt-20">
                        <div class="list-item-header">
                            <strong>Feature Items</strong>
                            <button class="btn btn-small btn-success" onclick="addFeatureItem()">+ Add Feature</button>
                        </div>
                        <div id="featureItems"></div>
                    </div>
                </div>

                <!-- Courses Section -->
                <div class="form-group">
                    <label>üìö Courses Section</label>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="courses_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Section Visible</span>
                    </div>

                    <input type="text" id="courses_title" placeholder="Courses Title" class="mb-10">
                    <input type="text" id="courses_subtitle" placeholder="Courses Subtitle" class="mb-10">

                    <div class="list-manager mt-20">
                        <div class="list-item-header">
                            <strong>Course Cards</strong>
                            <button class="btn btn-small btn-success" onclick="addCourseCard()">+ Add Course</button>
                        </div>
                        <div id="courseCards"></div>
                    </div>
                </div>

                <!-- Testimonials Section -->
                <div class="form-group">
                    <label>üí¨ Testimonials Section</label>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="testimonials_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Section Visible</span>
                    </div>

                    <input type="text" id="testimonials_title" placeholder="Testimonials Title" class="mb-10">
                    <input type="text" id="testimonials_subtitle" placeholder="Testimonials Subtitle" class="mb-10">

                    <div class="list-manager mt-20">
                        <div class="list-item-header">
                            <strong>Testimonial Items</strong>
                            <button class="btn btn-small btn-success" onclick="addTestimonial()">+ Add Testimonial</button>
                        </div>
                        <div id="testimonialItems"></div>
                    </div>
                </div>

                <!-- Awards Section -->
                <div class="form-group">
                    <label>üèÜ Awards Section</label>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="awards_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Section Visible</span>
                    </div>

                    <input type="text" id="awards_title" placeholder="Awards Title (e.g., Awards That Define Our Excellence.)" class="mb-10">
                    <input type="text" id="awards_subtitle" placeholder="Awards Subtitle" class="mb-10">

                    <div class="list-manager mt-20">
                        <div class="list-item-header">
                            <strong>Award Items</strong>
                            <button class="btn btn-small btn-success" onclick="addAwardItem()">+ Add Award</button>
                        </div>
                        <div id="awardItems"></div>
                    </div>
                </div>

                <!-- Pricing Plans Section -->
                <div class="form-group">
                    <label>üí∞ Pricing Plans</label>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="pricing_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Section Visible</span>
                    </div>

                    <input type="text" id="pricing_title" placeholder="Pricing Title (e.g., Choose Your Learning Path)" class="mb-10">
                    <input type="text" id="pricing_subtitle" placeholder="Pricing Subtitle (e.g., Flexible Pricing Plans)" class="mb-10">

                    <div class="list-manager mt-20">
                        <div class="list-item-header">
                            <strong>Pricing Plans (Basic, Pro, Enterprise)</strong>
                            <button class="btn btn-small btn-success" onclick="addPricingPlan()">+ Add Plan</button>
                        </div>
                        <div id="pricingPlans"></div>
                    </div>
                </div>

                <!-- CTA Section -->
                <div class="form-group">
                    <label>üì¢ Call to Action</label>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="cta_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Section Visible</span>
                    </div>

                    <input type="text" id="cta_title" placeholder="CTA Title" class="mb-10">
                    <textarea id="cta_description" placeholder="CTA Description"></textarea>
                    <input type="text" id="cta_button_text" placeholder="Button Text" class="mb-10">
                    <input type="text" id="cta_button_url" placeholder="Button URL" class="mb-10">
                </div>

                <!-- Save Buttons -->
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button class="btn" onclick="saveHomeContent()">üíæ Save Changes</button>
                    <button class="btn btn-secondary" onclick="loadHomeContent()">üîÑ Reload Content</button>
                    <button class="btn btn-secondary" onclick="exportContent()">üì• Export JSON</button>
                    <button class="btn btn-secondary" onclick="importContent()">üì§ Import JSON</button>
                </div>
            </div>

            <!-- Courses Section -->
            <div class="content-section" id="courses">
                <div class="section-header">
                    <div class="section-title">Courses Management</div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-small btn-success" onclick="showAddCourseForm()">‚ûï Add New Course</button>
                        <button class="btn btn-small" onclick="loadAllCourses()">üîÑ Refresh</button>
                    </div>
                </div>

                <!-- Course List -->
                <div id="coursesList" style="margin-bottom: 30px;">
                    <div style="text-align: center; padding: 40px; color: #999;">
                        Loading courses...
                    </div>
                </div>

                <!-- Add/Edit Course Form (hidden by default) -->
                <div id="courseForm" style="display: none; background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 id="courseFormTitle">Add New Course</h3>

                    <input type="hidden" id="course_id">

                    <div class="form-group">
                        <label>üìò Course Title *</label>
                        <input type="text" id="course_title" placeholder="Enter course title" required>
                    </div>

                    <div class="form-group">
                        <label>üìù Description *</label>
                        <textarea id="course_description" placeholder="Enter course description" rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label>üéØ Short Description</label>
                        <input type="text" id="course_short_description" placeholder="Brief course summary">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>üí∞ Price</label>
                            <input type="number" id="course_price" placeholder="99.99" step="0.01">
                        </div>

                        <div class="form-group">
                            <label>üè∑Ô∏è Old Price (for discount display)</label>
                            <input type="number" id="course_old_price" placeholder="149.99" step="0.01">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>‚è±Ô∏è Duration</label>
                            <input type="text" id="course_duration" placeholder="e.g., 8 weeks, 30 hours">
                        </div>

                        <div class="form-group">
                            <label>üìä Level</label>
                            <select id="course_level">
                                <option value="">Select Level</option>
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advanced">Advanced</option>
                                <option value="All Levels">All Levels</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üè∑Ô∏è Category</label>
                        <select id="course_category" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Select Category</option>
                            <option value="Web Development">Web Development</option>
                            <option value="App Development">App Development</option>
                            <option value="Machine Learning">Machine Learning</option>
                            <option value="Cloud Computing">Cloud Computing</option>
                            <option value="Data Science">Data Science</option>
                            <option value="Artificial Intelligence">Artificial Intelligence</option>
                            <option value="DevOps">DevOps</option>
                            <option value="Cybersecurity">Cybersecurity</option>
                            <option value="Blockchain">Blockchain</option>
                            <option value="General">General</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>üë®‚Äçüè´ Instructor</label>
                        <input type="text" id="course_instructor" placeholder="Instructor name">
                    </div>

                    <div class="form-group">
                        <label>üñºÔ∏è Thumbnail Image URL</label>
                        <input type="url" id="course_image" placeholder="https://example.com/course-image.jpg">
                    </div>

                    <div class="form-group">
                        <label>üé• Video URL (for preview)</label>
                        <input type="url" id="course_video_url" placeholder="https://youtube.com/watch?v=...">
                    </div>

                    <div class="form-group">
                        <label>üîó Course Link/URL</label>
                        <input type="url" id="course_link" placeholder="https://example.com/course-page">
                    </div>

                    <div class="form-group">
                        <label>‚≠ê Rating (1-5)</label>
                        <input type="number" id="course_rating" placeholder="4.5" min="0" max="5" step="0.1">
                    </div>

                    <div class="form-group">
                        <label>üë• Students Enrolled</label>
                        <input type="number" id="course_students" placeholder="1500">
                    </div>

                    <div class="form-group">
                        <label>üí¨ Reviews Count</label>
                        <input type="text" id="course_reviews" placeholder="e.g. 2,340">
                    </div>

                    <div class="form-group">
                        <label>üìö Lessons Count</label>
                        <input type="text" id="course_lessons" placeholder="e.g. 120">
                    </div>

                    <div class="form-group">
                        <label>üöÄ Features (comma-separated)</label>
                        <textarea id="course_features" placeholder="Live sessions, Projects, Certificate, Support" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label>üìö Syllabus/Modules (one per line)</label>
                        <textarea id="course_syllabus" placeholder="Module 1: Introduction&#10;Module 2: Advanced Topics&#10;Module 3: Projects" rows="4"></textarea>
                    </div>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="course_featured" >
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Featured Course</span>
                    </div>

                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="course_visible" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Course Visible</span>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn" onclick="saveCourse()">üíæ Save Course</button>
                        <button class="btn btn-secondary" onclick="cancelCourseForm()">‚ùå Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Pricing Content -->
            <div class="content-section" id="pricing">
                <div class="section-header">
                    <div class="section-title">Pricing Page Management</div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-small btn-success" onclick="savePricingData()">üíæ Save Changes</button>
                        <button class="btn btn-small" onclick="loadPricingData()">üîÑ Refresh</button>
                    </div>
                </div>

                <div id="pricingContent">
                    <!-- Hero Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üéØ Hero Section</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="pricing_hero_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="pricing_hero_title" placeholder="Hero Title (e.g., Choose Your Learning Path)" class="mb-10">
                        <textarea id="pricing_hero_subtitle" placeholder="Hero Subtitle" rows="2" class="mb-10"></textarea>
                    </div>

                    <!-- Pricing Plans -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üí∞ Pricing Plans</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="pricing_plans_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <textarea id="pricing_plans_description" placeholder="Plans section description (e.g., 'Dive into a world of learning with diverse courses...')" rows="2" class="mb-10"></textarea>
                        <div class="list-manager mt-20">
                            <div class="list-item-header">
                                <strong>Pricing Plans</strong>
                                <button class="btn btn-small btn-success" onclick="addPricingPlanItem()">+ Add Plan</button>
                            </div>
                            <div id="pricingPlansList"></div>
                        </div>
                    </div>

                    <!-- Features Comparison Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üîç Features Comparison</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="pricing_features_comparison_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="pricing_features_comparison_title" placeholder="Features Comparison Title" class="mb-10">
                        <textarea id="pricing_features_comparison_subtitle" placeholder="Features Comparison Subtitle" rows="2" class="mb-10"></textarea>
                        <textarea id="pricing_features_comparison_description" placeholder="Features Comparison Description" rows="3" class="mb-10"></textarea>
                    </div>

                    <!-- FAQs Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">‚ùì FAQs</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="pricing_faqs_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="pricing_faqs_title" placeholder="FAQs Title" class="mb-10">
                        <textarea id="pricing_faqs_subtitle" placeholder="FAQs Subtitle" rows="2" class="mb-10"></textarea>
                        <textarea id="pricing_faqs_description" placeholder="FAQs Content" rows="3" class="mb-10"></textarea>
                    </div>

                    <!-- Testimonials Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üí¨ Testimonials</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="pricing_testimonials_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="pricing_testimonials_title" placeholder="Testimonials Title" class="mb-10">
                        <textarea id="pricing_testimonials_subtitle" placeholder="Testimonials Subtitle" rows="2" class="mb-10"></textarea>
                        <textarea id="pricing_testimonials_description" placeholder="Testimonials Content" rows="3" class="mb-10"></textarea>
                    </div>

                    <!-- CTA Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üì¢ Call to Action</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="pricing_cta_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="pricing_cta_title" placeholder="CTA Title" class="mb-10">
                        <textarea id="pricing_cta_description" placeholder="CTA Description" rows="2" class="mb-10"></textarea>
                        <input type="text" id="pricing_cta_button_text" placeholder="Button Text" class="mb-10">
                        <input type="text" id="pricing_cta_button_url" placeholder="Button URL" class="mb-10">
                    </div>
                </div>
            </div>

            <!-- Teachers Content -->
            <div class="content-section" id="teachers">
                <div class="section-header">
                    <div class="section-title">Teachers Page Management</div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-small btn-success" onclick="saveTeachersData()">üíæ Save Changes</button>
                        <button class="btn btn-small" onclick="loadTeachersData()">üîÑ Refresh</button>
                    </div>
                </div>

                <div id="teachersContent">
                    <!-- Hero Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üéØ Hero Section</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="teachers_hero_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="teachers_hero_title" placeholder="Hero Title (e.g., Our Teachers)" class="mb-10">
                        <input type="text" id="teachers_hero_subtitle" placeholder="Hero Subtitle (e.g., Meet Our Team)" class="mb-10">
                        <textarea id="teachers_hero_description" placeholder="Hero Description" rows="2" class="mb-10"></textarea>
                    </div>

                    <!-- Instructor Grid Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üë®‚Äçüè´ Instructor Grid</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="teachers_instructor_grid_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="teachers_instructor_grid_title" placeholder="Section Title" class="mb-10">
                        <input type="text" id="teachers_instructor_grid_subtitle" placeholder="Section Subtitle" class="mb-10">
                        <textarea id="teachers_instructor_grid_description" placeholder="Section Description" rows="3" class="mb-10"></textarea>

                        <div class="list-manager mt-20">
                            <div class="list-item-header">
                                <strong>Instructors</strong>
                                <button class="btn btn-small btn-success" onclick="addInstructorItem()">+ Add Instructor</button>
                            </div>
                            <div id="instructorsList"></div>
                        </div>
                    </div>

                    <!-- Become Instructor Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üì¢ Become Instructor CTA</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="teachers_become_instructor_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>
                        <input type="text" id="teachers_become_instructor_title" placeholder="CTA Title" class="mb-10">
                        <input type="text" id="teachers_become_instructor_subtitle" placeholder="CTA Subtitle" class="mb-10">
                        <textarea id="teachers_become_instructor_description" placeholder="CTA Description" rows="2" class="mb-10"></textarea>
                        <input type="text" id="teachers_become_instructor_primary_button" placeholder="Primary Button Text" class="mb-10">
                        <input type="text" id="teachers_become_instructor_primary_link" placeholder="Primary Button Link" class="mb-10">
                        <input type="text" id="teachers_become_instructor_secondary_button" placeholder="Secondary Button Text" class="mb-10">
                        <input type="text" id="teachers_become_instructor_secondary_link" placeholder="Secondary Button Link" class="mb-10">
                    </div>

                    <!-- Stats Section -->
                    <div class="form-group" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label style="margin: 0;">üìä Stats Section</label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="teachers_stats_visible" checked>
                                <span>Visible</span>
                            </label>
                        </div>

                        <div class="list-manager mt-20">
                            <div class="list-item-header">
                                <strong>Stats Items</strong>
                                <button class="btn btn-small btn-success" onclick="addStatsItem()">+ Add Item</button>
                            </div>
                            <div id="statsList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section" id="blog">
                <div class="section-header">
                    <div class="section-title">Blog Management</div>
                    <button class="btn" onclick="loadBlogPosts()">üîÑ Refresh</button>
                </div>

                <div id="blog-posts-container">
                    <div class="loading">Loading blog posts...</div>
                </div>

                <div class="form-section">
                    <h3>Add New Blog Post</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üìù Title</label>
                            <input type="text" id="new-blog-title" placeholder="Enter blog post title">
                        </div>
                        <div class="form-group">
                            <label>üë§ Author</label>
                            <input type="text" id="new-blog-author" placeholder="Author name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üè∑Ô∏è Category</label>
                            <select id="new-blog-category">
                                <option value="ai">AI & Machine Learning</option>
                                <option value="web">Web Development</option>
                                <option value="career">Career Development</option>
                                <option value="data">Data Science</option>
                                <option value="security">Cybersecurity</option>
                                <option value="design">UI/UX Design</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üîó Article URL</label>
                            <input type="url" id="new-blog-url" placeholder="https://blog.example.com/article">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>üìÑ Excerpt</label>
                        <textarea id="new-blog-excerpt" placeholder="Brief description of the article"></textarea>
                    </div>
                    <div class="form-group">
                        <label>üìù Content</label>
                        <textarea id="new-blog-content" placeholder="Full article content" rows="5"></textarea>
                    </div>
                    <button class="btn" onclick="addBlogPost()">‚ûï Add Blog Post</button>
                </div>
            </div>

            <div class="content-section" id="menu">
                <div class="section-header">
                    <div class="section-title">Navigation Menu</div>
                </div>
                <p>Menu management coming soon...</p>
            </div>

            <div class="content-section" id="footer">
                <div class="section-header">
                    <div class="section-title">Footer Content</div>
                </div>
                <p>Footer management coming soon...</p>
            </div>

            <div class="content-section" id="settings">
                <div class="section-header">
                    <div class="section-title">Global Settings</div>
                </div>

                <div class="form-group">
                    <label>üé¨ Animation Settings</label>
                    <div class="visibility-group">
                        <label class="visibility-toggle">
                            <input type="checkbox" id="animations_enabled" checked>
                            <span class="visibility-slider"></span>
                        </label>
                        <span>Enable Animations Globally</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>üåç Default Language</label>
                    <select id="default_language">
                        <option value="en">English</option>
                        <option value="ru">Russian</option>
                        <option value="he">Hebrew</option>
                    </select>
                </div>

                <button class="btn" onclick="saveSettings()">üíæ Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toaster Container -->
    <div class="toaster-container" id="toasterContainer"></div>

    <script>
        // API Configuration
        const API_BASE = window.location.hostname === 'localhost'
            ? 'http://localhost:3000/api/nd'
            : '/api/nd';

        // Current language
        let currentLang = 'en';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeTabs();
            initializeLanguageSwitcher();
            loadHomeContent();
            // Load pricing data for search indexing
            loadPricingData();
        });

        // Tab Management
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', async () => {
                    // Remove active from all
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));

                    // Add active to clicked
                    tab.classList.add('active');
                    const tabId = tab.dataset.tab;
                    document.getElementById(tabId).classList.add('active');

                    // Load content for specific tabs
                    if (tabId === 'courses') {
                        console.log('üéØ Courses tab activated, loading courses...');
                        await loadAllCourses();
                    } else if (tabId === 'pricing') {
                        console.log('üí∞ Pricing tab activated, loading pricing data...');
                        await loadPricingData();
                    } else if (tabId === 'teachers') {
                        console.log('üë®‚Äçüè´ Teachers tab activated, loading teachers data...');
                        await loadTeachersData();
                    }
                });
            });
        }

        // Language Switcher
        function initializeLanguageSwitcher() {
            const langBtns = document.querySelectorAll('.lang-btn');
            langBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    langBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentLang = btn.dataset.lang;
                    loadHomeContent();
                });
            });
        }

        // Load Home Content
        async function loadHomeContent() {
            showLoading();
            try {
                const response = await fetch(`${API_BASE}/home-page?locale=${currentLang}`);
                const data = await response.json();

                if (data.success) {
                    populateHomeForm(data.data);
                    showToast('Content loaded successfully', 'success');
                    // Rebuild search index after loading data
                    setTimeout(buildSearchIndex, 500);
                }
            } catch (error) {
                showToast('Failed to load content', 'error');
                console.error(error);
            } finally {
                hideLoading();
            }
        }

        // Populate Form
        function populateHomeForm(data) {
            // Hero Section
            if (data.hero) {
                document.getElementById('hero_visible').checked = data.hero.visible;
                document.getElementById('hero_title').value = data.hero.content?.title || '';
                document.getElementById('hero_subtitle').value = data.hero.content?.subtitle || '';
                document.getElementById('hero_description').value = data.hero.content?.description || '';

                // Hero Buttons
                const buttonsContainer = document.getElementById('heroButtons');
                buttonsContainer.innerHTML = '';
                (data.hero.content?.buttons || []).forEach(btn => {
                    addHeroButton(btn);
                });
            }

            // Features Section
            if (data.features) {
                document.getElementById('features_visible').checked = data.features.visible;
                document.getElementById('features_title').value = data.features.content?.title || '';
                document.getElementById('features_subtitle').value = data.features.content?.subtitle || '';

                // Feature Items
                const featuresContainer = document.getElementById('featureItems');
                featuresContainer.innerHTML = '';
                (data.features.content?.items || []).forEach(item => {
                    addFeatureItem(item);
                });
            }

            // Courses Section
            if (data.courses) {
                document.getElementById('courses_visible').checked = data.courses.visible;
                document.getElementById('courses_title').value = data.courses.content?.title || '';
                document.getElementById('courses_subtitle').value = data.courses.content?.subtitle || '';
            }

            // Testimonials Section
            if (data.testimonials) {
                document.getElementById('testimonials_visible').checked = data.testimonials.visible;
                document.getElementById('testimonials_title').value = data.testimonials.content?.title || '';
                document.getElementById('testimonials_subtitle').value = data.testimonials.content?.subtitle || '';
            }

            // Awards Section
            if (data.awards) {
                document.getElementById('awards_visible').checked = data.awards.visible !== false;
                document.getElementById('awards_title').value = data.awards.content?.title || '';
                document.getElementById('awards_subtitle').value = data.awards.content?.subtitle || '';

                // Award Items
                const awardsContainer = document.getElementById('awardItems');
                awardsContainer.innerHTML = '';
                (data.awards.content?.items || []).forEach(item => {
                    addAwardItem(item);
                });
            }

            // Pricing Section
            if (data.pricing) {
                document.getElementById('pricing_visible').checked = data.pricing.visible !== false;
                document.getElementById('pricing_title').value = data.pricing.content?.title || 'Choose Your Learning Path';
                document.getElementById('pricing_subtitle').value = data.pricing.content?.subtitle || 'Flexible Pricing Plans';

                // Pricing Plans
                const pricingContainer = document.getElementById('pricingPlans');
                pricingContainer.innerHTML = '';
                (data.pricing.content?.plans || []).forEach(plan => {
                    addPricingPlan(plan);
                });
            } else {
                // Add default pricing plans if none exist
                const defaultPlans = [
                    { id: 'basic', name: 'Basic Plan', price_monthly: '29', price_yearly: '278', description: 'Perfect for beginners', features: ['50+ courses', 'Community support', 'Certificates'], featured: false },
                    { id: 'pro', name: 'Pro Plan', price_monthly: '79', price_yearly: '758', description: 'For serious learners', features: ['All courses', 'Priority support', '1-on-1 mentoring', 'Job placement'], featured: true, popular_badge: 'Most Popular' },
                    { id: 'enterprise', name: 'Enterprise', price_monthly: 'Custom', price_yearly: 'Custom', description: 'For teams', features: ['Everything in Pro', 'Unlimited team members', 'Dedicated manager'], featured: false }
                ];
                document.getElementById('pricingPlans').innerHTML = '';
                defaultPlans.forEach(plan => addPricingPlan(plan));
            }

            // CTA Section
            if (data.cta_1) {
                document.getElementById('cta_visible').checked = data.cta_1.visible;
                document.getElementById('cta_title').value = data.cta_1.content?.title || '';
                document.getElementById('cta_description').value = data.cta_1.content?.description || '';
                document.getElementById('cta_button_text').value = data.cta_1.content?.buttonText || '';
                document.getElementById('cta_button_url').value = data.cta_1.content?.buttonUrl || '';
            }
        }

        // Save Home Content
        async function saveHomeContent() {
            showLoading();

            const sections = {
                hero: {
                    visible: document.getElementById('hero_visible').checked,
                    content: {
                        title: document.getElementById('hero_title').value,
                        subtitle: document.getElementById('hero_subtitle').value,
                        description: document.getElementById('hero_description').value,
                        buttons: getHeroButtons()
                    }
                },
                features: {
                    visible: document.getElementById('features_visible').checked,
                    content: {
                        title: document.getElementById('features_title').value,
                        subtitle: document.getElementById('features_subtitle').value,
                        items: getFeatureItems()
                    }
                },
                courses: {
                    visible: document.getElementById('courses_visible').checked,
                    content: {
                        title: document.getElementById('courses_title').value,
                        subtitle: document.getElementById('courses_subtitle').value
                    }
                },
                testimonials: {
                    visible: document.getElementById('testimonials_visible').checked,
                    content: {
                        title: document.getElementById('testimonials_title').value,
                        subtitle: document.getElementById('testimonials_subtitle').value
                    }
                },
                awards: {
                    visible: document.getElementById('awards_visible').checked,
                    content: {
                        title: document.getElementById('awards_title').value,
                        subtitle: document.getElementById('awards_subtitle').value,
                        items: getAwardItems()
                    }
                },
                pricing: {
                    visible: document.getElementById('pricing_visible').checked,
                    content: {
                        title: document.getElementById('pricing_title').value,
                        subtitle: document.getElementById('pricing_subtitle').value,
                        plans: getPricingPlans()
                    }
                },
                cta_1: {
                    visible: document.getElementById('cta_visible').checked,
                    content: {
                        title: document.getElementById('cta_title').value,
                        description: document.getElementById('cta_description').value,
                        buttonText: document.getElementById('cta_button_text').value,
                        buttonUrl: document.getElementById('cta_button_url').value
                    }
                }
            };

            try {
                // Save each section
                for (const [key, data] of Object.entries(sections)) {
                    const payload = {};
                    payload[`content_${currentLang}`] = data.content;
                    payload.visible = data.visible;

                    await fetch(`${API_BASE}/home-page/${key}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                }

                showToast('Content saved successfully', 'success');
            } catch (error) {
                showToast('Failed to save content', 'error');
                console.error(error);
            } finally {
                hideLoading();
            }
        }

        // Dynamic List Management
        function addHeroButton(data = {}) {
            const container = document.getElementById('heroButtons');
            const id = Date.now();
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `
                <input type="text" placeholder="Button Text" value="${data.text || ''}" class="mb-10" data-field="text">
                <input type="text" placeholder="Button URL" value="${data.url || ''}" class="mb-10" data-field="url">
                <select data-field="style">
                    <option value="primary" ${data.style === 'primary' ? 'selected' : ''}>Primary</option>
                    <option value="secondary" ${data.style === 'secondary' ? 'selected' : ''}>Secondary</option>
                </select>
                <button class="btn btn-small btn-danger" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(item);
        }

        function addFeatureItem(data = {}) {
            const container = document.getElementById('featureItems');
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `
                <input type="text" placeholder="Feature Title" value="${data.title || ''}" class="mb-10" data-field="title">
                <textarea placeholder="Feature Description" data-field="description">${data.description || ''}</textarea>
                <input type="text" placeholder="Icon Class" value="${data.icon || ''}" class="mb-10" data-field="icon">
                <button class="btn btn-small btn-danger" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(item);
        }

        function getHeroButtons() {
            const buttons = [];
            document.querySelectorAll('#heroButtons .list-item').forEach(item => {
                buttons.push({
                    text: item.querySelector('[data-field="text"]').value,
                    url: item.querySelector('[data-field="url"]').value,
                    style: item.querySelector('[data-field="style"]').value
                });
            });
            return buttons;
        }

        function getFeatureItems() {
            const items = [];
            document.querySelectorAll('#featureItems .list-item').forEach(item => {
                items.push({
                    title: item.querySelector('[data-field="title"]').value,
                    description: item.querySelector('[data-field="description"]').value,
                    icon: item.querySelector('[data-field="icon"]').value,
                    visible: true
                });
            });
            return items;
        }

        function addAwardItem(data = {}) {
            const container = document.getElementById('awardItems');
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `
                <input type="text" placeholder="Award Title" value="${data.title || ''}" class="mb-10" data-field="title">
                <textarea placeholder="Award Description" data-field="description">${data.description || ''}</textarea>
                <input type="text" placeholder="Award Year" value="${data.year || ''}" class="mb-10" data-field="year">
                <input type="text" placeholder="Award Icon/Image URL" value="${data.icon || ''}" class="mb-10" data-field="icon">
                <button class="btn btn-small btn-danger" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(item);
        }

        function getAwardItems() {
            const items = [];
            document.querySelectorAll('#awardItems .list-item').forEach(item => {
                items.push({
                    title: item.querySelector('[data-field="title"]').value,
                    description: item.querySelector('[data-field="description"]').value,
                    year: item.querySelector('[data-field="year"]').value,
                    icon: item.querySelector('[data-field="icon"]').value,
                    visible: true
                });
            });
            return items;
        }

        // Pricing Plan Functions
        function addPricingPlan(data = {}) {
            const container = document.getElementById('pricingPlans');
            const item = document.createElement('div');
            item.className = 'list-item';
            item.style.background = '#f8f9fa';
            item.style.padding = '20px';
            item.style.borderRadius = '8px';
            item.style.marginBottom = '15px';

            item.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <input type="text" placeholder="Plan Name (e.g., Basic Plan)" value="${data.name || ''}" class="mb-10" data-field="name">
                    <select data-field="id" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="basic" ${data.id === 'basic' ? 'selected' : ''}>Basic</option>
                        <option value="pro" ${data.id === 'pro' ? 'selected' : ''}>Pro</option>
                        <option value="enterprise" ${data.id === 'enterprise' ? 'selected' : ''}>Enterprise</option>
                    </select>
                </div>

                <textarea placeholder="Plan Description" data-field="description" style="margin-bottom: 10px;">${data.description || ''}</textarea>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <input type="text" placeholder="Monthly Price (e.g., 29 or Custom)" value="${data.price_monthly || ''}" data-field="price_monthly">
                    <input type="text" placeholder="Yearly Price (e.g., 278 or Custom)" value="${data.price_yearly || ''}" data-field="price_yearly">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <input type="text" placeholder="CTA Button Text" value="${data.cta_text || 'Get Started'}" data-field="cta_text">
                    <input type="text" placeholder="CTA Button Link" value="${data.cta_link || '#signup'}" data-field="cta_link">
                </div>

                <textarea placeholder="Features (one per line)" data-field="features" rows="6" style="margin-bottom: 10px;">${Array.isArray(data.features) ? data.features.join('\n') : (data.features || '')}</textarea>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" ${data.featured ? 'checked' : ''} data-field="featured">
                        Featured Plan
                    </label>
                    <input type="text" placeholder="Popular Badge Text" value="${data.popular_badge || ''}" data-field="popular_badge" style="flex: 1;">
                    <input type="color" value="${data.color_scheme || '#667EEA'}" data-field="color_scheme" title="Plan Color Scheme">
                    <button class="btn btn-small btn-danger" onclick="this.parentElement.parentElement.remove()">Remove Plan</button>
                </div>
            `;
            container.appendChild(item);
        }

        function getPricingPlans() {
            const plans = [];
            document.querySelectorAll('#pricingPlans .list-item').forEach(item => {
                const featuresText = item.querySelector('[data-field="features"]').value;
                plans.push({
                    id: item.querySelector('[data-field="id"]').value,
                    name: item.querySelector('[data-field="name"]').value,
                    description: item.querySelector('[data-field="description"]').value,
                    price_monthly: item.querySelector('[data-field="price_monthly"]').value,
                    price_yearly: item.querySelector('[data-field="price_yearly"]').value,
                    cta_text: item.querySelector('[data-field="cta_text"]').value,
                    cta_link: item.querySelector('[data-field="cta_link"]').value,
                    features: featuresText.split('\n').map(f => f.trim()).filter(f => f),
                    featured: item.querySelector('[data-field="featured"]').checked,
                    popular_badge: item.querySelector('[data-field="popular_badge"]').value,
                    color_scheme: item.querySelector('[data-field="color_scheme"]').value
                });
            });
            return plans;
        }

        // Preview Changes
        function previewChanges() {
            const url = `/nd/home.html?preview=true`;
            window.open(url, '_blank');
        }

        // Export/Import
        function exportContent() {
            // Implement export functionality
            showToast('Export feature coming soon', 'info');
        }

        function importContent() {
            // Implement import functionality
            showToast('Import feature coming soon', 'info');
        }

        // Settings
        async function saveSettings() {
            const enabled = document.getElementById('animations_enabled').checked;

            try {
                await fetch(`${API_BASE}/settings/animations`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ page: 'home', enabled })
                });
                showToast('Settings saved successfully', 'success');
            } catch (error) {
                showToast('Failed to save settings', 'error');
            }
        }

        // UI Helpers
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toasterContainer');
            const toast = document.createElement('div');
            toast.className = `toaster ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; cursor: pointer;">‚úï</button>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Search Functionality
        let searchIndex = [];
        let searchTimeout;

        function buildSearchIndex() {
            searchIndex = [];

            // Get all content sections
            const sections = document.querySelectorAll('.content-section');

            sections.forEach(section => {
                const sectionName = section.id;
                const sectionTitle = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);

                // Index all inputs and textareas in this section
                const fields = section.querySelectorAll('input[type="text"], input[type="url"], input[type="email"], textarea, select');

                fields.forEach(field => {
                    const fieldId = field.id;
                    const fieldLabel = field.placeholder ||
                                     field.previousElementSibling?.textContent ||
                                     fieldId.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                    const fieldValue = field.value || '';

                    if (fieldId && (fieldValue || fieldLabel)) {
                        searchIndex.push({
                            section: sectionTitle,
                            sectionId: sectionName,
                            field: fieldLabel,
                            fieldId: fieldId,
                            value: fieldValue,
                            element: field
                        });
                    }
                });

                // Also index list items (hero buttons, features, etc.)
                const listItems = section.querySelectorAll('.list-item');
                listItems.forEach((item, index) => {
                    const inputs = item.querySelectorAll('input, textarea');
                    inputs.forEach(input => {
                        const value = input.value || '';
                        if (value) {
                            searchIndex.push({
                                section: sectionTitle,
                                sectionId: sectionName,
                                field: input.placeholder || 'List Item',
                                fieldId: input.id || `${sectionName}_item_${index}`,
                                value: value,
                                element: input
                            });
                        }
                    });
                });
            });

            console.log(`Search index built with ${searchIndex.length} items`);
        }

        function performSearch(query) {
            const resultsContainer = document.getElementById('searchResults');

            if (!query || query.length < 2) {
                resultsContainer.innerHTML = '';
                resultsContainer.classList.remove('active');
                return;
            }

            const lowerQuery = query.toLowerCase();
            const results = searchIndex.filter(item => {
                const fieldMatch = item.field && item.field.toLowerCase().includes(lowerQuery);
                const valueMatch = item.value && item.value.toLowerCase().includes(lowerQuery);
                const sectionMatch = item.section && item.section.toLowerCase().includes(lowerQuery);
                return fieldMatch || valueMatch || sectionMatch;
            });

            displaySearchResults(results, query);
        }

        function displaySearchResults(results, query) {
            const resultsContainer = document.getElementById('searchResults');

            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">No matching content found</div>';
                resultsContainer.classList.add('active');
                return;
            }

            let html = '';
            results.forEach(result => {
                const highlightedField = highlightText(result.field, query);
                const highlightedValue = highlightText(result.value.substring(0, 200), query);
                const highlightedSection = highlightText(result.section, query);

                html += `
                    <div class="search-result-item" onclick="goToResult('${result.sectionId}', '${result.fieldId}')">
                        <div class="search-result-section">${highlightedSection}</div>
                        <div class="search-result-field">${highlightedField}</div>
                        <div class="search-result-value">${highlightedValue}${result.value.length > 200 ? '...' : ''}</div>
                    </div>
                `;
            });

            resultsContainer.innerHTML = html;
            resultsContainer.classList.add('active');
        }

        function highlightText(text, query) {
            if (!text) return '';
            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function goToResult(sectionId, fieldId) {
            // First, switch to the correct tab
            const tabs = document.querySelectorAll('.tab');
            const sections = document.querySelectorAll('.content-section');

            tabs.forEach(tab => {
                if (tab.dataset.tab === sectionId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            sections.forEach(section => {
                if (section.id === sectionId) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });

            // Clear search results
            clearSearch();

            // Scroll to and highlight the field
            setTimeout(() => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    field.style.transition = 'all 0.3s';
                    field.style.boxShadow = '0 0 0 5px rgba(102, 126, 234, 0.3)';
                    field.style.borderColor = '#667eea';
                    field.focus();

                    setTimeout(() => {
                        field.style.boxShadow = '';
                        field.style.borderColor = '';
                    }, 3000);
                }
            }, 300);
        }

        function clearSearch() {
            document.getElementById('adminSearch').value = '';
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';
            resultsContainer.classList.remove('active');
        }

        // Course Management Functions
        let allCourses = [];
        let editingCourseId = null;

        async function loadAllCourses() {
            try {
                console.log('üîÑ Loading courses from nd_courses table...');
                // Now using dedicated nd_courses table
                const response = await fetch(`${API_BASE}/courses?locale=${currentLang}`);
                const data = await response.json();

                console.log('üì° API Response:', {
                    success: data.success,
                    coursesCount: data.data ? data.data.length : 0
                });

                if (data.success && data.data && data.data.length > 0) {
                    allCourses = data.data;
                    console.log(`‚úÖ Loaded ${allCourses.length} courses from nd_courses:`, allCourses.map(c => c.title));
                    displayCourses();
                    showToast('Courses loaded successfully', 'success');
                } else if (data.success && data.data && data.data.length === 0) {
                    console.log('üìù No courses in database');
                    allCourses = [];
                    displayCourses();
                    showToast('No courses found', 'info');
                } else {
                    throw new Error(data.error || 'Failed to load courses');
                }
            } catch (error) {
                console.error('‚ùå Error loading courses:', error);
                showToast('Failed to load courses', 'error');
                allCourses = [];
                displayCourses();
            }
        }

        function displayCourses() {
            console.log('üé® Displaying courses:', allCourses.length);
            const coursesList = document.getElementById('coursesList');

            if (!coursesList) {
                console.error('‚ùå coursesList element not found!');
                return;
            }

            if (!allCourses || allCourses.length === 0) {
                console.log('üìù No courses to display, showing empty state');
                coursesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <p>No courses found</p>
                        <button class="btn btn-small btn-success" onclick="showAddCourseForm()">‚ûï Add Your First Course</button>
                    </div>
                `;
                return;
            }

            let html = '<div style="display: grid; gap: 15px;">';

            allCourses.forEach((course) => {
                const featured = course.featured ? '<span style="background: #ffc107; color: black; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">‚≠ê FEATURED</span>' : '';
                const visible = course.visible !== false ? '<span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">üëÅÔ∏è VISIBLE</span>' : '<span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">üö´ HIDDEN</span>';

                html += `
                    <div style="background: white; border: 2px solid #e1e1e1; border-radius: 12px; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 10px 0; color: #333;">
                                ${course.title || 'Untitled Course'}
                                ${featured}
                                ${visible}
                            </h4>
                            <p style="color: #666; margin: 5px 0;">${course.short_description || course.description?.substring(0, 100) || 'No description'}</p>
                            <div style="display: flex; gap: 20px; margin-top: 10px; font-size: 14px; color: #999;">
                                ${course.price ? `<span>üí∞ $${course.price}</span>` : ''}
                                ${course.instructor ? `<span>üë®‚Äçüè´ ${course.instructor}</span>` : ''}
                                ${course.level ? `<span>üìä ${course.level}</span>` : ''}
                                ${course.students_count ? `<span>üë• ${course.students_count} students</span>` : ''}
                                ${course.rating ? `<span>‚≠ê ${course.rating}/5</span>` : ''}
                                ${course.duration ? `<span>‚è±Ô∏è ${course.duration}</span>` : ''}
                                ${course.lessons_count ? `<span>üìö ${course.lessons_count} lessons</span>` : ''}
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-small" onclick="editCourse(${course.id})">‚úèÔ∏è Edit</button>
                            <button class="btn btn-small btn-danger" onclick="deleteCourse(${course.id})">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            console.log('üìù Setting coursesList innerHTML, length:', html.length);
            coursesList.innerHTML = html;
            console.log('‚úÖ Courses displayed in DOM, element count:', coursesList.children.length);
        }

        function showAddCourseForm() {
            document.getElementById('courseFormTitle').textContent = 'Add New Course';
            document.getElementById('courseForm').style.display = 'block';
            document.getElementById('coursesList').style.display = 'none';

            // Clear form
            editingCourseId = null;
            document.getElementById('course_id').value = '';
            document.getElementById('course_title').value = '';
            document.getElementById('course_description').value = '';
            document.getElementById('course_short_description').value = '';
            document.getElementById('course_price').value = '';
            document.getElementById('course_old_price').value = '';
            document.getElementById('course_duration').value = '';
            document.getElementById('course_level').value = '';
            document.getElementById('course_category').value = '';
            document.getElementById('course_instructor').value = '';
            document.getElementById('course_image').value = '';
            document.getElementById('course_video_url').value = '';
            document.getElementById('course_link').value = '';
            document.getElementById('course_rating').value = '';
            document.getElementById('course_students').value = '';
            document.getElementById('course_reviews').value = '';
            document.getElementById('course_lessons').value = '';
            document.getElementById('course_features').value = '';
            document.getElementById('course_syllabus').value = '';
            document.getElementById('course_featured').checked = false;
            document.getElementById('course_visible').checked = true;

            // Scroll to form
            document.getElementById('courseForm').scrollIntoView({ behavior: 'smooth' });
        }

        function editCourse(courseId) {
            const course = allCourses.find(c => c.id === courseId);
            if (!course) return;

            editingCourseId = courseId;
            document.getElementById('courseFormTitle').textContent = 'Edit Course';
            document.getElementById('courseForm').style.display = 'block';
            document.getElementById('coursesList').style.display = 'none';

            // Populate form
            document.getElementById('course_id').value = course.id;
            document.getElementById('course_title').value = course.title || '';
            document.getElementById('course_description').value = course.description || '';
            document.getElementById('course_short_description').value = course.short_description || '';
            document.getElementById('course_price').value = course.price || '';
            document.getElementById('course_old_price').value = course.old_price || '';
            document.getElementById('course_duration').value = course.duration || '';
            document.getElementById('course_level').value = course.level || '';
            document.getElementById('course_category').value = course.category || '';
            document.getElementById('course_instructor').value = course.instructor || '';
            document.getElementById('course_image').value = course.image || '';
            document.getElementById('course_video_url').value = course.video_url || '';
            document.getElementById('course_link').value = course.link || '';
            document.getElementById('course_rating').value = course.rating || '';
            document.getElementById('course_students').value = course.students_count || '';
            document.getElementById('course_reviews').value = course.reviews_count || '';
            document.getElementById('course_lessons').value = course.lessons_count || '';
            document.getElementById('course_features').value = Array.isArray(course.features) ? course.features.join(', ') : (course.features || '');
            document.getElementById('course_syllabus').value = Array.isArray(course.syllabus) ? course.syllabus.join('\n') : (course.syllabus || '');
            document.getElementById('course_featured').checked = course.featured || false;
            document.getElementById('course_visible').checked = course.visible !== false;

            // Scroll to form
            document.getElementById('courseForm').scrollIntoView({ behavior: 'smooth' });
        }

        async function saveCourse() {
            const courseData = {
                title: document.getElementById('course_title').value,
                description: document.getElementById('course_description').value,
                short_description: document.getElementById('course_short_description').value,
                price: parseFloat(document.getElementById('course_price').value) || null,
                old_price: parseFloat(document.getElementById('course_old_price').value) || null,
                duration: document.getElementById('course_duration').value,
                level: document.getElementById('course_level').value,
                category: document.getElementById('course_category').value,
                instructor: document.getElementById('course_instructor').value,
                image: document.getElementById('course_image').value,
                video_url: document.getElementById('course_video_url').value,
                link: document.getElementById('course_link').value,
                rating: parseFloat(document.getElementById('course_rating').value) || null,
                students: parseInt(document.getElementById('course_students').value) || null,
                reviews: document.getElementById('course_reviews').value || '',
                lessons: document.getElementById('course_lessons').value || '',
                features: document.getElementById('course_features').value.split(',').map(f => f.trim()).filter(f => f),
                syllabus: document.getElementById('course_syllabus').value.split('\n').map(s => s.trim()).filter(s => s),
                featured: document.getElementById('course_featured').checked,
                visible: document.getElementById('course_visible').checked
            };

            if (!courseData.title || !courseData.description) {
                showToast('Please fill in required fields (Title and Description)', 'error');
                return;
            }

            showLoading();
            try {
                // Map field names to match database schema
                const apiData = {
                    title: courseData.title,
                    description: courseData.description,
                    short_description: courseData.short_description,
                    price: courseData.price,
                    old_price: courseData.old_price,
                    duration: courseData.duration,
                    level: courseData.level,
                    category: courseData.category,
                    instructor: courseData.instructor,
                    image: courseData.image,
                    video_url: courseData.video_url,
                    url: courseData.link,
                    rating: courseData.rating,
                    reviews_count: parseInt(courseData.reviews?.replace(/[^0-9]/g, '')) || 0,
                    students_count: courseData.students,
                    lessons_count: parseInt(courseData.lessons?.replace(/[^0-9]/g, '')) || 0,
                    features: courseData.features,
                    syllabus: courseData.syllabus,
                    featured: courseData.featured,
                    visible: courseData.visible
                };

                // Save directly to nd_courses table
                const response = await fetch(
                    editingCourseId !== null
                        ? `${API_BASE}/courses/${editingCourseId}`
                        : `${API_BASE}/courses`,
                    {
                        method: editingCourseId !== null ? 'PUT' : 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(apiData)
                    }
                );

                const result = await response.json();

                if (result.success || response.ok) {
                    showToast(editingCourseId !== null ? 'Course updated successfully' : 'Course created successfully', 'success');
                    cancelCourseForm();
                    await loadAllCourses();
                    // Rebuild search index
                    setTimeout(buildSearchIndex, 500);
                } else {
                    throw new Error(result.message || 'Failed to save course');
                }
            } catch (error) {
                showToast('Failed to save course', 'error');
                console.error(error);
            } finally {
                hideLoading();
            }
        }

        async function deleteCourse(courseId) {
            if (!confirm('Are you sure you want to delete this course?')) return;

            showLoading();
            try {
                // Delete directly from nd_courses table
                const response = await fetch(`${API_BASE}/courses/${courseId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success || response.ok) {
                    showToast('Course deleted successfully', 'success');
                    await loadAllCourses();
                    // Rebuild search index
                    setTimeout(buildSearchIndex, 500);
                } else {
                    throw new Error(result.message || 'Failed to delete course');
                }
            } catch (error) {
                showToast('Failed to delete course', 'error');
                console.error(error);
            } finally {
                hideLoading();
            }
        }

        function cancelCourseForm() {
            document.getElementById('courseForm').style.display = 'none';
            document.getElementById('coursesList').style.display = 'block';
            editingCourseId = null;
        }

        // ==========================================
        // PRICING PAGE FUNCTIONS
        // ==========================================

        async function loadPricingData() {
            try {
                showLoading();
                console.log('üìä Loading pricing data from nd_pricing_page...');

                const response = await fetch(`${API_BASE}/pricing-page?locale=${currentLang}`);
                const result = await response.json();

                if (result.success && result.data) {
                    const sections = result.data.attributes?.sections || {};

                    // Hero section
                    const hero = sections.hero || {};
                    document.getElementById('pricing_hero_title').value = hero.title || '';
                    document.getElementById('pricing_hero_subtitle').value = hero.subtitle || '';
                    document.getElementById('pricing_hero_visible').checked = hero.visible !== false;

                    // Features Comparison section
                    const featuresComparison = sections.features_comparison || {};
                    document.getElementById('pricing_features_comparison_title').value = featuresComparison.title || '';
                    document.getElementById('pricing_features_comparison_subtitle').value = featuresComparison.subtitle || '';
                    document.getElementById('pricing_features_comparison_description').value = featuresComparison.description || '';
                    document.getElementById('pricing_features_comparison_visible').checked = featuresComparison.visible !== false;

                    // FAQs section
                    const faqs = sections.faqs || {};
                    document.getElementById('pricing_faqs_title').value = faqs.title || '';
                    document.getElementById('pricing_faqs_subtitle').value = faqs.subtitle || '';
                    document.getElementById('pricing_faqs_description').value = faqs.description || '';
                    document.getElementById('pricing_faqs_visible').checked = faqs.visible !== false;

                    // Testimonials section
                    const testimonials = sections.testimonials || {};
                    document.getElementById('pricing_testimonials_title').value = testimonials.title || '';
                    document.getElementById('pricing_testimonials_subtitle').value = testimonials.subtitle || '';
                    document.getElementById('pricing_testimonials_description').value = testimonials.description || '';
                    document.getElementById('pricing_testimonials_visible').checked = testimonials.visible !== false;

                    // CTA section
                    const cta = sections.cta || {};
                    document.getElementById('pricing_cta_title').value = cta.title || '';
                    document.getElementById('pricing_cta_description').value = cta.description || '';
                    document.getElementById('pricing_cta_button_text').value = cta.button_text || '';
                    document.getElementById('pricing_cta_button_url').value = cta.button_url || '';
                    document.getElementById('pricing_cta_visible').checked = cta.visible !== false;

                    // Plans section visibility and description
                    const plans = sections.plans || {};
                    document.getElementById('pricing_plans_visible').checked = plans.visible !== false;
                    document.getElementById('pricing_plans_description').value = plans.description || '';

                    // Load pricing plans
                    const plansContainer = document.getElementById('pricingPlansList');
                    plansContainer.innerHTML = '';

                    const plansData = sections.plans?.plans || [];
                    if (Array.isArray(plansData)) {
                        plansData.forEach(plan => addPricingPlanItem(plan));
                    }

                    showToast('Pricing data loaded successfully', 'success');
                    // Rebuild search index after pricing data loads
                    setTimeout(() => {
                        buildSearchIndex();
                        console.log('üîç Search index rebuilt after pricing data load');
                    }, 500);
                } else {
                    showToast('No pricing data found', 'warning');
                }
            } catch (error) {
                console.error('Error loading pricing data:', error);
                showToast('Failed to load pricing data', 'error');
            } finally {
                hideLoading();
            }
        }

        async function savePricingData() {
            try {
                showLoading();
                console.log('üíæ Saving pricing data to nd_pricing_page...');

                // Collect pricing plans
                const plans = [];
                document.querySelectorAll('#pricingPlansList .pricing-plan-item').forEach(item => {
                    const featuresText = item.querySelector('[data-field="features"]').value;
                    plans.push({
                        name: item.querySelector('[data-field="name"]').value,
                        monthly_price: item.querySelector('[data-field="monthly_price"]').value,
                        yearly_price: item.querySelector('[data-field="yearly_price"]').value,
                        description: item.querySelector('[data-field="description"]').value,
                        features: featuresText.split('\n').map(f => f.trim()).filter(f => f),
                        button_text: item.querySelector('[data-field="button_text"]').value,
                        button_url: item.querySelector('[data-field="button_url"]').value,
                        featured: item.querySelector('[data-field="featured"]')?.checked || false,
                        // Keep legacy fields for backward compatibility
                        price: item.querySelector('[data-field="monthly_price"]').value,
                        price_period: '/month'
                    });
                });

                const pricingData = {
                    hero: {
                        title: document.getElementById('pricing_hero_title').value,
                        subtitle: document.getElementById('pricing_hero_subtitle').value,
                        visible: document.getElementById('pricing_hero_visible').checked
                    },
                    plans: {
                        plans: plans,
                        description: document.getElementById('pricing_plans_description').value,
                        visible: document.getElementById('pricing_plans_visible').checked
                    },
                    features_comparison: {
                        title: document.getElementById('pricing_features_comparison_title').value,
                        subtitle: document.getElementById('pricing_features_comparison_subtitle').value,
                        description: document.getElementById('pricing_features_comparison_description').value,
                        visible: document.getElementById('pricing_features_comparison_visible').checked
                    },
                    faqs: {
                        title: document.getElementById('pricing_faqs_title').value,
                        subtitle: document.getElementById('pricing_faqs_subtitle').value,
                        description: document.getElementById('pricing_faqs_description').value,
                        visible: document.getElementById('pricing_faqs_visible').checked
                    },
                    testimonials: {
                        title: document.getElementById('pricing_testimonials_title').value,
                        subtitle: document.getElementById('pricing_testimonials_subtitle').value,
                        description: document.getElementById('pricing_testimonials_description').value,
                        visible: document.getElementById('pricing_testimonials_visible').checked
                    },
                    cta: {
                        title: document.getElementById('pricing_cta_title').value,
                        description: document.getElementById('pricing_cta_description').value,
                        button_text: document.getElementById('pricing_cta_button_text').value,
                        button_url: document.getElementById('pricing_cta_button_url').value,
                        visible: document.getElementById('pricing_cta_visible').checked
                    }
                };

                // Save each section separately
                const sections = {
                    hero: pricingData.hero,
                    plans: pricingData.plans,
                    features_comparison: pricingData.features_comparison,
                    faqs: pricingData.faqs,
                    testimonials: pricingData.testimonials,
                    cta: pricingData.cta
                };

                let allSuccess = true;
                for (const [sectionName, content] of Object.entries(sections)) {
                    const response = await fetch(`${API_BASE}/pricing-page/${sectionName}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content, locale: currentLang })
                    });

                    if (!response.ok) {
                        allSuccess = false;
                        console.error(`Failed to save ${sectionName} section`);
                    }
                }

                if (allSuccess) {
                    showToast('Pricing data saved successfully', 'success');
                } else {
                    throw new Error('Some sections failed to save');
                }
            } catch (error) {
                console.error('Error saving pricing data:', error);
                showToast('Failed to save pricing data', 'error');
            } finally {
                hideLoading();
            }
        }

        function addPricingPlanItem(data = {}) {
            const container = document.getElementById('pricingPlansList');
            const item = document.createElement('div');
            item.className = 'pricing-plan-item';
            item.style.cssText = 'background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;';

            item.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 10px;">
                    <input type="text" placeholder="Plan Name" value="${data.name || ''}" data-field="name">
                </div>

                <div style="background: #e8f4f8; padding: 15px; border-radius: 6px; margin-bottom: 10px;">
                    <label style="font-weight: bold; display: block; margin-bottom: 10px;">üí∞ Pricing (Monthly & Yearly):</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #666;">Monthly Price:</label>
                            <input type="text" placeholder="$29/month" value="${data.monthly_price || data.price || ''}" data-field="monthly_price">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #666;">Yearly Price:</label>
                            <input type="text" placeholder="$290/year" value="${data.yearly_price || ''}" data-field="yearly_price">
                        </div>
                    </div>
                </div>

                <textarea placeholder="Plan Description" data-field="description" rows="2" style="margin-bottom: 10px;">${data.description || ''}</textarea>

                <div style="margin-bottom: 10px;">
                    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Features (one per line - e.g., "Access All Courses"):</label>
                    <textarea placeholder="Enter features one per line:\n‚úì Access All Courses\n‚úì Priority Support\n‚úì Certificate of Completion" data-field="features" rows="6" style="width: 100%; font-family: monospace;">${Array.isArray(data.features) ? data.features.join('\n') : (data.features || '')}</textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <input type="text" placeholder="Button Text" value="${data.button_text || 'Get Started'}" data-field="button_text">
                    <input type="text" placeholder="Button URL" value="${data.button_url || '#'}" data-field="button_url">
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" ${data.featured ? 'checked' : ''} data-field="featured">
                        Featured Plan
                    </label>
                    <button class="btn btn-small btn-danger" onclick="this.parentElement.parentElement.remove()">Remove</button>
                </div>
            `;

            container.appendChild(item);
        }

        // ==================== TEACHERS MANAGEMENT FUNCTIONS ====================

        // Load teachers data
        async function loadTeachersData() {
            try {
                showLoading();
                console.log('üìä Loading teachers data from nd_teachers_page...');

                const response = await fetch(`${API_BASE}/nd/teachers-page?locale=${currentLang}`);
                const result = await response.json();

                if (result.success && result.data) {
                    console.log('‚úÖ Teachers data loaded:', result.data);

                    // Process sections
                    result.data.forEach(section => {
                        const content = section.content || {};

                        switch (section.section_name) {
                            case 'hero':
                                document.getElementById('teachers_hero_title').value = content.title || '';
                                document.getElementById('teachers_hero_subtitle').value = content.subtitle || '';
                                document.getElementById('teachers_hero_description').value = content.description || '';
                                document.getElementById('teachers_hero_visible').checked = section.visible !== false;
                                break;

                            case 'instructor_grid':
                                document.getElementById('teachers_instructor_grid_title').value = content.title || '';
                                document.getElementById('teachers_instructor_grid_subtitle').value = content.subtitle || '';
                                document.getElementById('teachers_instructor_grid_description').value = content.description || '';
                                document.getElementById('teachers_instructor_grid_visible').checked = section.visible !== false;

                                // Load instructors
                                const instructorsContainer = document.getElementById('instructorsList');
                                instructorsContainer.innerHTML = '';
                                const instructors = content.instructors || [];
                                if (Array.isArray(instructors)) {
                                    instructors.forEach(instructor => addInstructorItem(instructor));
                                }
                                break;

                            case 'become_instructor':
                                document.getElementById('teachers_become_instructor_title').value = content.title || '';
                                document.getElementById('teachers_become_instructor_subtitle').value = content.subtitle || '';
                                document.getElementById('teachers_become_instructor_description').value = content.description || '';
                                document.getElementById('teachers_become_instructor_primary_button').value = content.primary_button || '';
                                document.getElementById('teachers_become_instructor_primary_link').value = content.primary_link || '';
                                document.getElementById('teachers_become_instructor_secondary_button').value = content.secondary_button || '';
                                document.getElementById('teachers_become_instructor_secondary_link').value = content.secondary_link || '';
                                document.getElementById('teachers_become_instructor_visible').checked = section.visible !== false;
                                break;

                            case 'stats':
                                document.getElementById('teachers_stats_visible').checked = section.visible !== false;

                                // Load stats items
                                const statsContainer = document.getElementById('statsList');
                                statsContainer.innerHTML = '';
                                const statsItems = content.items || [];
                                if (Array.isArray(statsItems)) {
                                    statsItems.forEach(item => addStatsItem(item));
                                }
                                break;
                        }
                    });

                    showToast('Teachers data loaded successfully', 'success');
                } else {
                    showToast('No teachers data found', 'warning');
                }
            } catch (error) {
                console.error('Error loading teachers data:', error);
                showToast('Failed to load teachers data', 'error');
            } finally {
                hideLoading();
            }
        }

        // Save teachers data
        async function saveTeachersData() {
            try {
                showLoading();
                console.log('üíæ Saving teachers data to nd_teachers_page...');

                // Collect instructors
                const instructors = [];
                document.querySelectorAll('#instructorsList .instructor-item').forEach(item => {
                    instructors.push({
                        id: instructors.length + 1,
                        name: item.querySelector('[data-field="name"]').value,
                        expertise: item.querySelector('[data-field="expertise"]').value,
                        bio: item.querySelector('[data-field="bio"]').value,
                        image: item.querySelector('[data-field="image"]').value,
                        profile_link: item.querySelector('[data-field="profile_link"]').value
                    });
                });

                // Collect stats items
                const statsItems = [];
                document.querySelectorAll('#statsList .stats-item').forEach(item => {
                    statsItems.push({
                        text: item.querySelector('[data-field="text"]').value
                    });
                });

                const sectionsData = {
                    hero: {
                        title: document.getElementById('teachers_hero_title').value,
                        subtitle: document.getElementById('teachers_hero_subtitle').value,
                        description: document.getElementById('teachers_hero_description').value,
                        visible: document.getElementById('teachers_hero_visible').checked
                    },
                    instructor_grid: {
                        title: document.getElementById('teachers_instructor_grid_title').value,
                        subtitle: document.getElementById('teachers_instructor_grid_subtitle').value,
                        description: document.getElementById('teachers_instructor_grid_description').value,
                        instructors: instructors,
                        visible: document.getElementById('teachers_instructor_grid_visible').checked
                    },
                    become_instructor: {
                        title: document.getElementById('teachers_become_instructor_title').value,
                        subtitle: document.getElementById('teachers_become_instructor_subtitle').value,
                        description: document.getElementById('teachers_become_instructor_description').value,
                        primary_button: document.getElementById('teachers_become_instructor_primary_button').value,
                        primary_link: document.getElementById('teachers_become_instructor_primary_link').value,
                        secondary_button: document.getElementById('teachers_become_instructor_secondary_button').value,
                        secondary_link: document.getElementById('teachers_become_instructor_secondary_link').value,
                        visible: document.getElementById('teachers_become_instructor_visible').checked
                    },
                    stats: {
                        items: statsItems,
                        visible: document.getElementById('teachers_stats_visible').checked
                    }
                };

                // Save each section
                for (const [sectionName, sectionData] of Object.entries(sectionsData)) {
                    const response = await fetch(`${API_BASE}/nd/teachers-page/${sectionName}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content: sectionData, locale: currentLang })
                    });

                    const result = await response.json();
                    if (!result.success) {
                        throw new Error(`Failed to save ${sectionName} section: ${result.error}`);
                    }
                }

                showToast('Teachers data saved successfully', 'success');
            } catch (error) {
                console.error('Error saving teachers data:', error);
                showToast('Failed to save teachers data: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // Add instructor item
        function addInstructorItem(data = {}) {
            const container = document.getElementById('instructorsList');
            const item = document.createElement('div');
            item.className = 'instructor-item';
            item.style.cssText = 'background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;';

            item.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <input type="text" placeholder="Instructor Name" value="${data.name || ''}" data-field="name">
                    <input type="text" placeholder="Expertise (e.g., AI & Machine Learning)" value="${data.expertise || ''}" data-field="expertise">
                </div>
                <div style="margin-bottom: 10px;">
                    <input type="text" placeholder="Image URL" value="${data.image || ''}" data-field="image" style="width: 100%;">
                </div>
                <div style="margin-bottom: 10px;">
                    <textarea placeholder="Bio/Description" data-field="bio" rows="3" style="width: 100%;">${data.bio || ''}</textarea>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" placeholder="Profile Link" value="${data.profile_link || '#'}" data-field="profile_link" style="flex: 1;">
                    <button class="btn btn-small btn-danger" onclick="this.parentElement.parentElement.remove()">Remove</button>
                </div>
            `;

            container.appendChild(item);
        }

        // Add stats item
        function addStatsItem(data = {}) {
            const container = document.getElementById('statsList');
            const item = document.createElement('div');
            item.className = 'stats-item';
            item.style.cssText = 'background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px;';

            item.innerHTML = `
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" placeholder="Stats Text (e.g., Start Learning)" value="${data.text || ''}" data-field="text" style="flex: 1;">
                    <button class="btn btn-small btn-danger" onclick="this.parentElement.parentElement.remove()">Remove</button>
                </div>
            `;

            container.appendChild(item);
        }

        // Blog Management Functions
        async function loadBlogPosts() {
            const container = document.getElementById('blog-posts-container');
            container.innerHTML = '<div class="loading">Loading blog posts...</div>';

            try {
                const response = await fetch('/api/blog-posts');
                const result = await response.json();
                const posts = result.data || [];

                if (posts.length === 0) {
                    container.innerHTML = '<p>No blog posts found. Add your first post below!</p>';
                    return;
                }

                container.innerHTML = posts.map(post => `
                    <div class="blog-post-item" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: grid; grid-template-columns: 1fr 200px; gap: 15px; margin-bottom: 10px;">
                            <div>
                                <h4>${post.attributes.title}</h4>
                                <p style="color: #666; margin: 5px 0;">by ${post.attributes.author}</p>
                                <p style="color: #888; font-size: 14px;">${post.attributes.excerpt}</p>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button class="btn btn-small" onclick="editBlogPost(${post.id})">‚úèÔ∏è Edit</button>
                                <button class="btn btn-small btn-danger" onclick="deleteBlogPost(${post.id})">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px; color: #666;">
                            <div><strong>Category:</strong> ${post.attributes.category || 'None'}</div>
                            <div><strong>URL:</strong> ${post.attributes.url ? `<a href="${post.attributes.url}" target="_blank">${post.attributes.url}</a>` : 'No URL'}</div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                container.innerHTML = '<p style="color: red;">Error loading blog posts: ' + error.message + '</p>';
            }
        }

        async function addBlogPost() {
            const title = document.getElementById('new-blog-title').value;
            const author = document.getElementById('new-blog-author').value;
            const category = document.getElementById('new-blog-category').value;
            const url = document.getElementById('new-blog-url').value;
            const excerpt = document.getElementById('new-blog-excerpt').value;
            const content = document.getElementById('new-blog-content').value;

            if (!title || !author || !excerpt) {
                alert('Please fill in title, author, and excerpt fields');
                return;
            }

            try {
                const response = await fetch('/api/blog-posts', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title,
                        author,
                        category,
                        url: url || null,
                        excerpt,
                        content,
                        slug: title.toLowerCase().replace(/[^\\w ]+/g, '').replace(/ +/g, '-'),
                        published_at: new Date().toISOString(),
                        locale: 'en'
                    })
                });

                if (response.ok) {
                    alert('Blog post added successfully!');
                    // Clear form
                    document.getElementById('new-blog-title').value = '';
                    document.getElementById('new-blog-author').value = '';
                    document.getElementById('new-blog-url').value = '';
                    document.getElementById('new-blog-excerpt').value = '';
                    document.getElementById('new-blog-content').value = '';
                    // Reload posts
                    loadBlogPosts();
                } else {
                    alert('Error adding blog post');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function editBlogPost(id) {
            // For now, just show an alert. Full editing would require more complex UI
            alert('Editing functionality coming soon! For now, you can delete and re-add posts.');
        }

        async function deleteBlogPost(id) {
            if (!confirm('Are you sure you want to delete this blog post?')) {
                return;
            }

            try {
                const response = await fetch(`/api/blog-posts/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Blog post deleted successfully!');
                    loadBlogPosts();
                } else {
                    alert('Error deleting blog post');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Initialize search
        document.addEventListener('DOMContentLoaded', function() {
            // Build initial search index after a short delay
            setTimeout(() => {
                buildSearchIndex();
            }, 1000);

            // Auto-load blog posts when blog tab is clicked
            const blogTab = document.querySelector('[data-tab="blog"]');
            if (blogTab) {
                blogTab.addEventListener('click', function() {
                    setTimeout(loadBlogPosts, 100);
                });
            }

            // Add search event listeners
            const searchInput = document.getElementById('adminSearch');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        performSearch(e.target.value);
                    }, 300);
                });

                // Allow Enter key to search immediately
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        clearTimeout(searchTimeout);
                        performSearch(e.target.value);
                    }
                });
            }

            // Rebuild index when content changes
            const observer = new MutationObserver(() => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(buildSearchIndex, 1000);
            });

            const adminCard = document.querySelector('.admin-card');
            if (adminCard) {
                observer.observe(adminCard, {
                    childList: true,
                    subtree: true,
                    attributes: true,
                    attributeFilter: ['value']
                });
            }
        });

        // Utility Classes
        const style = document.createElement('style');
        style.textContent = `
            .mb-10 { margin-bottom: 10px; }
            .mb-20 { margin-bottom: 20px; }
            .mt-20 { margin-top: 20px; }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>