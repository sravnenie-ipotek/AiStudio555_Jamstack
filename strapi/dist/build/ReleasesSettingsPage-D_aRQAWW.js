import{j as e,k as d,u as T,d as C,b as I,ad as w,ae as A,e as S,af as y,L as m,q as F,ag as L,ah as E,ai as D,a3 as B,a5 as G,aj as j,ak as H,al as N,am as l,an as U,ao as _}from"./strapi-CQJ1aB9a.js";import{u as p}from"./hooks-eFowFGnq.js";import{S as k}from"./schemas-eqbsP7rV.js";const V=()=>{const{formatMessage:s}=T(),{formatAPIError:o}=C(),{toggleNotification:i}=I(),{data:c,isLoading:t}=w(),[a,{isLoading:z}]=A(),b=p(r=>r.admin_app.permissions.settings?.releases),{allowedActions:{canUpdate:v}}=S(b),{timezoneList:M}=y(new Date),R=async(r,{setErrors:u})=>{const{defaultTimezone:g}=r,h=g,x=M.some(n=>n.value===h);if(!x&&g){const n=s({id:"components.Input.error.validation.combobox.invalid",defaultMessage:"The value provided is not valid"});u({defaultTimezone:n}),i({type:"danger",message:n});return}const P=!g||!x?{defaultTimezone:null}:{defaultTimezone:h};try{const n=await a(P);"data"in n?i({type:"success",message:s({id:"content-releases.pages.Settings.releases.setting.default-timezone-notification-success",defaultMessage:"Default timezone updated."})}):H(n.error)?i({type:"danger",message:o(n.error)}):i({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})})}catch{i({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})})}};if(t)return e.jsx(d.Loading,{});const f=s({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"});return e.jsxs(m.Root,{children:[e.jsx(d.Title,{children:s({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:f})}),e.jsx(d.Main,{"aria-busy":t,tabIndex:-1,children:e.jsx(F,{method:"PUT",initialValues:{defaultTimezone:c?.data.defaultTimezone},onSubmit:R,validationSchema:k,children:({modified:r,isSubmitting:u})=>e.jsxs(e.Fragment,{children:[e.jsx(m.Header,{primaryAction:v?e.jsx(E,{disabled:!r||z,loading:u,startIcon:e.jsx(D,{}),type:"submit",children:s({id:"global.save",defaultMessage:"Save"})}):null,secondaryAction:e.jsx(L,{label:s({id:"components.premiumFeature.title",defaultMessage:"Premium feature"})}),title:f,subtitle:s({id:"content-releases.pages.Settings.releases.description",defaultMessage:"Create and manage content updates"})}),e.jsx(m.Content,{children:e.jsxs(B,{direction:"column",background:"neutral0",alignItems:"stretch",padding:6,gap:6,shadow:"filterShadow",hasRadius:!0,children:[e.jsx(G,{variant:"delta",tag:"h2",children:s({id:"content-releases.pages.Settings.releases.preferences.title",defaultMessage:"Preferences"})}),e.jsx(j.Root,{children:e.jsx(j.Item,{col:6,s:12,direction:"column",alignItems:"stretch",children:e.jsx(q,{})})})]})})]})})})]})},q=()=>{const s=p(a=>a.admin_app.permissions.settings?.releases),{allowedActions:{canUpdate:o}}=S(s),{formatMessage:i}=T(),{timezoneList:c}=y(new Date),t=N("defaultTimezone");return e.jsxs(l.Root,{name:"defaultTimezone",hint:i({id:"content-releases.pages.Settings.releases.timezone.hint",defaultMessage:"The timezone of every release can still be changed individually."}),error:t.error,children:[e.jsx(l.Label,{children:i({id:"content-releases.pages.Settings.releases.timezone.label",defaultMessage:"Default timezone"})}),e.jsx(U,{autocomplete:{type:"list",filter:"contains"},onTextValueChange:a=>t.onChange("defaultTimezone",a),onChange:a=>{(t.value&&a||!t.value)&&t.onChange("defaultTimezone",a)},onClear:()=>t.onChange("defaultTimezone",""),value:t.value,disabled:!o,children:c.map(a=>e.jsx(_,{value:a.value,children:a.value.replace(/&/," ")},a.value))}),e.jsx(l.Hint,{}),e.jsx(l.Error,{})]})},$=()=>{const s=p(o=>o.admin_app.permissions.settings?.releases?.read);return e.jsx(d.Protect,{permissions:s,children:e.jsx(V,{})})};export{$ as ProtectedReleasesSettingsPage};
