import{X as T,u as I,b as A,d as N,b6 as k,b7 as D,b8 as v,r as w,b9 as O,j as s,k as u,ba as R}from"./strapi-CQJ1aB9a.js";import{C as U,T as G}from"./Form-CVvTqhfM.js";import{u as H}from"./hooks-Bu31WWqB.js";import"./sortable.esm-_742qA-T.js";import"./FieldTypeIcon-4I7PkMhC.js";const Q=()=>{const{trackUsage:r}=T(),{formatMessage:o}=I(),{toggleNotification:a}=A(),{_unstableFormatAPIError:c}=N(),{isLoading:F,schema:y,model:L}=k(),{isLoading:S,error:b,list:E,edit:g}=D(),{fieldSizes:h,error:d,isLoading:x,isFetching:_}=v(void 0,{selectFromResult:e=>{const l=Object.entries(e.data?.fieldSizes??{}).reduce((n,[t,{default:i}])=>(n[t]=i,n),{});return{isFetching:e.isFetching,isLoading:e.isLoading,error:e.error,fieldSizes:l}}});w.useEffect(()=>{d&&a({type:"danger",message:c(d)})},[d,c,a]);const j=F||S||x||_,[C]=O(),M=async e=>{try{r("willSaveContentTypeLayout");const l=Object.entries(E.metadatas).reduce((t,[i,{mainField:m,...f}])=>{const z=g.metadatas[i],{__temp_key__:V,size:X,name:$,...P}=e.layout.flatMap(p=>p.children).find(p=>p.name===i)??{};return t[i]={edit:{...z,...P},list:f},t},{}),n=await C({layouts:{edit:e.layout.map(t=>t.children.reduce((i,{name:m,size:f})=>m!==G?[...i,{name:m,size:f}]:i,[])),list:E.layout.map(t=>t.name)},settings:R(e.settings,"displayName",void 0),metadatas:l,uid:L});"data"in n?(r("didEditEditSettings"),a({type:"success",message:o({id:"notification.success.saved",defaultMessage:"Saved"})})):a({type:"danger",message:c(n.error)})}catch{a({type:"danger",message:o({id:"notification.error",defaultMessage:"An error occurred"})})}};return j?s.jsx(u.Loading,{}):d||b||!y?s.jsx(u.Error,{}):s.jsxs(s.Fragment,{children:[s.jsx(u.Title,{children:`Configure ${g.settings.displayName} Edit View`}),s.jsx(U,{onSubmit:M,attributes:y.attributes,fieldSizes:h,layout:g})]})},Y=()=>{const r=H(o=>o.admin_app.permissions.contentManager?.collectionTypesConfigurations);return s.jsx(u.Protect,{permissions:r,children:s.jsx(Q,{})})};export{Q as EditConfigurationPage,Y as ProtectedEditConfigurationPage};
