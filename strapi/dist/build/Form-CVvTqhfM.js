import{u as B,b as ue,al as te,b8 as ge,cG as ne,j as e,cH as D,q as ae,i as he,a3 as j,cI as ie,aj as C,bb as u,M as se,ah as G,c6 as fe,n as xe,m as X,cJ as w,r as P,a5 as k,ax as ye,cK as W,be,x as U,a4 as je,_ as q,a6 as Ie,a7 as ve,cf as Ce,N as oe,cL as Fe,cM as Me,cN as Y,s as re,U as Se,L as J,bm as _e,bK as Te,bR as Re}from"./strapi-CQJ1aB9a.js";import{D as ke,S as $e,a as De,b as ze,u as we,c as de,C as Ne}from"./sortable.esm-_742qA-T.js";import{F as Ee}from"./FieldTypeIcon-4I7PkMhC.js";const Le=he().shape({label:X().required().nullable(),description:X(),editable:xe(),size:fe().required()}),Pe=({attribute:t,name:a,onClose:s})=>{const{formatMessage:o}=B(),{toggleNotification:l}=ue(),{value:c,onChange:g}=te(a),{data:I}=ge(void 0,{selectFromResult:p=>{if(t?.type!=="relation"||!p.data)return{data:[]};if("targetModel"in t&&typeof t.targetModel=="string"){const v=p.data.contentTypes.find(x=>x.uid===t.targetModel);if(v)return{data:Object.entries(v.attributes).reduce((x,[M,_])=>(ne.includes(_.type)||x.push({label:M,value:M}),x),[])}}return{data:[]}},skip:t?.type!=="relation"});return!c||c.name===R||!t?(console.error("You've opened a field to edit without it being part of the form, this is likely a bug with Strapi. Please open an issue."),l({message:o({id:"content-manager.containers.edit-settings.modal-form.error",defaultMessage:"An error occurred while trying to open the form."}),type:"danger"}),null):e.jsx(D.Content,{children:e.jsxs(ae,{method:"PUT",initialValues:c,validationSchema:Le,onSubmit:p=>{g(a,p),s()},children:[e.jsx(D.Header,{children:e.jsxs(j,{gap:3,children:[e.jsx(Ee,{type:t.type}),e.jsx(D.Title,{children:o({id:"content-manager.containers.edit-settings.modal-form.label",defaultMessage:"Edit {fieldName}"},{fieldName:ie(c.name)})})]})}),e.jsx(D.Body,{children:e.jsx(C.Root,{gap:4,children:[{name:"label",label:o({id:u("containers.edit-settings.modal-form.label"),defaultMessage:"Label"}),size:6,type:"string"},{name:"description",label:o({id:u("containers.edit-settings.modal-form.description"),defaultMessage:"Description"}),size:6,type:"string"},{name:"placeholder",label:o({id:u("containers.edit-settings.modal-form.placeholder"),defaultMessage:"Placeholder"}),size:6,type:"string"},{name:"editable",label:o({id:u("containers.edit-settings.modal-form.editable"),defaultMessage:"Editable"}),size:6,type:"boolean"},{name:"mainField",label:o({id:u("containers.edit-settings.modal-form.mainField"),defaultMessage:"Entry title"}),hint:o({id:u("containers.SettingPage.edit-settings.modal-form.mainField.hint"),defaultMessage:"Set the displayed field"}),size:6,options:I,type:"enumeration"},{name:"size",label:o({id:u("containers.ListSettingsView.modal-form.size"),defaultMessage:"Size"}),size:6,options:[{value:"4",label:"33%"},{value:"6",label:"50%"},{value:"8",label:"66%"},{value:"12",label:"100%"}],type:"enumeration"}].filter(Be(t.type)).map(({size:p,...v})=>e.jsx(C.Item,{col:p,direction:"column",alignItems:"stretch",children:e.jsx(se,{...v})},v.name))})}),e.jsxs(D.Footer,{children:[e.jsx(D.Close,{children:e.jsx(G,{variant:"tertiary",children:o({id:"app.components.Button.cancel",defaultMessage:"Cancel"})})}),e.jsx(G,{type:"submit",children:o({id:"global.finish",defaultMessage:"Finish"})})]})]})})},Be=t=>a=>{switch(t){case"blocks":case"richtext":return a.name!=="size"&&a.name!=="mainField";case"boolean":case"media":return a.name!=="placeholder"&&a.name!=="mainField";case"component":case"dynamiczone":return a.name==="label"||a.name==="editable";case"json":return a.name!=="placeholder"&&a.name!=="mainField"&&a.name!=="size";case"relation":return!0;default:return a.name!=="mainField"}},L=12,Ae=({id:t,children:a})=>{const s=we({id:t});return a(s)},Oe=({id:t,children:a})=>{const{attributes:s,setNodeRef:o,transform:l,transition:c}=de({id:t}),g={transform:Ne.Transform.toString(l),transition:c,height:"100%"};return e.jsx("div",{ref:o,style:g,...s,children:a})},Z=t=>t.map((a,s)=>({...a,dndId:`container-${s}`,children:a.children.map((o,l)=>({...o,dndId:`container-${s}-child-${l}`,formName:`layout.${s}.children.${l}`}))})),We=({attributes:t,fieldSizes:a,components:s,metadatas:o={}})=>{const{formatMessage:l}=B(),c=w("Fields",n=>n.values.layout??[]),g=w("Fields",n=>n.onChange),I=w("Fields",n=>n.addFieldRow),p=w("Fields",n=>n.removeFieldRow),v=c.map(n=>n.children.map(i=>i.name)).flat(),x=Object.entries(o).reduce((n,i)=>{const[r,{visible:m,...y}]=i;if(!v.includes(r)&&m===!0){const f=t[r]?.type,b=f?a[f]:L;n.push({...y,label:y.label??r,name:r,size:b})}return n},[]),M=(n,i)=>()=>{c[n].children.length===1?p("layout",n):g(`layout.${n}.children`,[...c[n].children.slice(0,i),...c[n].children.slice(i+1)])},_=n=>()=>{I("layout",{children:[n]})},[d,T]=P.useState(()=>Z(c)),[$,Q]=P.useState(null);function N(n,i){return n in i?n:Object.keys(i).find(r=>i[r].children.find(m=>m.dndId===n))}const H=(n,i)=>i.children.find(r=>n===r.dndId),V=()=>Object.fromEntries(d.map(n=>[n.dndId,n])),le=n=>n.map(i=>({...i,children:i.children.filter(r=>r.name!==R)})).filter(i=>i.children.length>0).map(i=>{const r=i.children.reduce((m,y)=>m+y.size,0);if(r<L){const[m]=Y(i.children.at(-1)?.__temp_key__,void 0,1);return{...i,children:[...i.children,{name:R,size:L-r,__temp_key__:m}]}}return i});return P.useEffect(()=>{const n=Z(c);T(n)},[c,T]),e.jsx(ke,{onDragStart:n=>{const i=V(),r=N(n.active.id,i);if(!r)return;const m=H(n.active.id,i[r]);m&&Q(m)},onDragOver:({active:n,over:i})=>{const r=V(),m=N(n.id,r),y=N(i?.id??"",r),f=d.findIndex(h=>h.dndId===m),b=d.findIndex(h=>h.dndId===y);if(!m||!y)return;const S=H(n.id,r[m]),A=H(i?.id??"",r[y]),E=r[y].children.findIndex(h=>h.dndId===i?.id);if(!S)return;if(S?.size===L){const h=U(d,O=>{O[f].children=d[b].children,O[b].children=d[f].children});T(h);return}const K=U(d,h=>{if(h[f].children=h[f].children.filter(z=>z.dndId!==n.id),h[b].children.reduce((z,F)=>F.name===R?z:z+F.size,0)+S.size>L){h[f].children=d[f].children;return}if(A?.name===R){h[b].children.splice(E,1,S);return}h[b].children.splice(E,0,S)});T(K)},onDragEnd:n=>{const{active:i,over:r}=n,{id:m}=i,y=r?.id,f=V(),b=N(m,f),S=N(y,f);if(!b||!S)return;const A=f[b].children.findIndex(F=>F.dndId===m),E=f[S].children.findIndex(F=>F.dndId===y),K=U(f,F=>{A!==E&&b===S&&(F[b].children=ze(F[b].children,A,E))}),h=Object.values(K),z=le(h).map(({dndId:F,children:ce,...me})=>({...me,children:ce.map(({dndId:Qe,formName:Xe,...pe})=>pe)}));g("layout",z),Q(null)},children:e.jsxs(j,{paddingTop:6,direction:"column",alignItems:"stretch",gap:4,children:[e.jsxs(j,{alignItems:"flex-start",direction:"column",justifyContent:"space-between",children:[e.jsx(k,{fontWeight:"bold",children:l({id:u("containers.list.displayedFields"),defaultMessage:"Displayed fields"})}),e.jsx(k,{variant:"pi",textColor:"neutral600",children:l({id:"containers.SettingPage.editSettings.description",defaultMessage:"Drag & drop the fields to build the layout"})})]}),e.jsx(ye,{padding:4,hasRadius:!0,borderStyle:"dashed",borderWidth:"1px",borderColor:"neutral300",children:e.jsxs(j,{direction:"column",alignItems:"stretch",gap:2,children:[d.map((n,i)=>e.jsx($e,{id:n.dndId,items:n.children.map(r=>({id:r.dndId})),children:e.jsx(Ae,{id:n.dndId,children:({setNodeRef:r})=>e.jsx(C.Root,{ref:r,gap:2,children:n.children.map((m,y)=>e.jsx(C.Item,{col:m.size,direction:"column",alignItems:"stretch",children:e.jsx(Oe,{id:m.dndId,children:e.jsx(ee,{attribute:t[m.name],components:s,name:m.formName,onRemoveField:M(i,y),dndId:m.dndId})})},m.dndId))},n.dndId)})},n.dndId)),e.jsx(De,{children:$?e.jsx(ee,{attribute:t[$.name],components:s,name:$.formName,dndId:$.dndId}):null}),e.jsxs(W.Root,{children:[e.jsx(W.Trigger,{startIcon:e.jsx(be,{}),endIcon:null,disabled:x.length===0,fullWidth:!0,variant:"secondary",children:l({id:u("containers.SettingPage.add.field"),defaultMessage:"Insert another field"})}),e.jsx(W.Content,{children:x.map(n=>e.jsx(W.Item,{onSelect:_(n),children:n.label},n.name))})]})]})})]})})},R="_TEMP_",ee=({attribute:t,components:a,name:s,onRemoveField:o,dndId:l})=>{const[c,g]=P.useState(!1),{formatMessage:I}=B(),{value:p}=te(s),{listeners:v,setActivatorNodeRef:x}=de({id:l}),M=d=>{d.preventDefault(),d.stopPropagation(),o&&o?.(d)},_=d=>{d.preventDefault(),d.stopPropagation(),g(!0)};return p?p.name===R?e.jsx(j,{tag:"span",height:"100%",style:{opacity:0}}):t?e.jsxs(D.Root,{open:c,onOpenChange:g,children:[e.jsxs(j,{borderColor:"neutral150",background:"neutral100",hasRadius:!0,gap:3,cursor:"pointer",onClick:()=>{g(!0)},children:[e.jsx(He,{ref:x,tag:"span",withTooltip:!1,label:I({id:u("components.DraggableCard.move.field"),defaultMessage:"Move {item}"},{item:p.label}),...v,children:e.jsx(je,{})}),e.jsxs(j,{direction:"column",alignItems:"flex-start",grow:1,overflow:"hidden",children:[e.jsxs(j,{gap:3,justifyContent:"space-between",width:"100%",children:[e.jsx(k,{ellipsis:!0,fontWeight:"bold",children:p.label}),e.jsxs(j,{children:[e.jsx(q,{type:"button",variant:"ghost",background:"transparent",onClick:_,withTooltip:!1,label:I({id:u("components.DraggableCard.edit.field"),defaultMessage:"Edit {item}"},{item:p.label}),children:e.jsx(Ie,{})}),e.jsx(q,{type:"button",variant:"ghost",onClick:M,background:"transparent",withTooltip:!1,label:I({id:u("components.DraggableCard.delete.field"),defaultMessage:"Delete {item}"},{item:p.label}),children:e.jsx(ve,{})})]})]}),t?.type==="component"?e.jsxs(j,{paddingTop:3,paddingRight:3,paddingBottom:3,paddingLeft:0,alignItems:"flex-start",direction:"column",gap:2,width:"100%",children:[e.jsx(C.Root,{gap:4,width:"100%",children:a[t.component].layout.map(d=>d.map(({size:T,...$})=>e.jsx(C.Item,{col:T,direction:"column",alignItems:"stretch",children:e.jsx(j,{alignItems:"center",background:"neutral0",paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,hasRadius:!0,borderColor:"neutral200",children:e.jsx(k,{textColor:"neutral800",children:$.name})})},$.name)))}),e.jsx(Ce,{onClick:d=>d.stopPropagation(),startIcon:e.jsx(Fe,{}),tag:oe,to:`../components/${t.component}/configurations/edit`,children:I({id:u("components.FieldItem.linkToComponentLayout"),defaultMessage:"Set the component's layout"})})]}):null,t?.type==="dynamiczone"?e.jsx(j,{paddingTop:3,paddingRight:3,paddingBottom:3,paddingLeft:0,alignItems:"flex-start",gap:2,width:"100%",wrap:"wrap",children:t?.components.map(d=>e.jsxs(Ve,{onClick:T=>T.stopPropagation(),to:`../components/${d}/configurations/edit`,children:[e.jsx(Me,{icon:a[d].settings.icon}),e.jsx(k,{fontSize:1,textColor:"neutral600",fontWeight:"bold",children:a[d].settings.displayName})]},d))}):null]})]}),p.name!==R&&e.jsx(Pe,{attribute:t,name:s,onClose:()=>g(!1)})]}):null:null},He=re(q)`
  height: unset;
  align-self: stretch;
  display: flex;
  align-items: center;
  padding: 0;
  border: none;
  background-color: transparent;
  border-radius: 0px;
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
  cursor: all-scroll;

  svg {
    width: 1.2rem;
    height: 1.2rem;
  }
`,Ve=re(oe)`
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: ${({theme:t})=>t.spaces[1]};
  padding: ${t=>t.theme.spaces[2]};
  border: 1px solid ${({theme:t})=>t.colors.neutral200};
  background: ${({theme:t})=>t.colors.neutral0};
  width: 14rem;
  border-radius: ${({theme:t})=>t.borderRadius};
  text-decoration: none;

  &:focus,
  &:hover {
    ${({theme:t})=>`
      background-color: ${t.colors.primary100};
      border-color: ${t.colors.primary200};

      ${k} {
          color: ${t.colors.primary600};
      }
    `}

    /* > ComponentIcon */
    > div:first-child {
      background: ${({theme:t})=>t.colors.primary200};
      color: ${({theme:t})=>t.colors.primary600};

      svg {
        path {
          fill: ${({theme:t})=>t.colors.primary600};
        }
      }
    }
  }
`,nt=({attributes:t,fieldSizes:a,layout:s,onSubmit:o})=>{const{components:l,settings:c,layout:g,metadatas:I}=s,{formatMessage:p}=B(),v=P.useMemo(()=>({layout:Se(Ke,Ue,Ge,qe,Ye)(g),settings:c}),[g,c]);return e.jsx(J.Root,{children:e.jsx(_e,{children:e.jsxs(ae,{initialValues:v,onSubmit:o,method:"PUT",children:[e.jsx(Je,{name:c.displayName??""}),e.jsx(J.Content,{children:e.jsxs(j,{alignItems:"stretch",background:"neutral0",direction:"column",gap:6,hasRadius:!0,shadow:"tableShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:[e.jsx(k,{variant:"delta",tag:"h2",children:p({id:u("containers.SettingPage.settings"),defaultMessage:"Settings"})}),e.jsxs(C.Root,{children:[e.jsx(C.Item,{col:6,s:12,direction:"column",alignItems:"stretch",children:e.jsx(se,{type:"enumeration",label:p({id:u("containers.SettingPage.editSettings.entry.title"),defaultMessage:"Entry title"}),hint:p({id:u("containers.SettingPage.editSettings.entry.title.description"),defaultMessage:"Set the display field of your entry"}),name:"settings.mainField",options:Object.entries(t).reduce((x,[M,_])=>(_&&(ne.includes(_.type)||x.push({label:M,value:M})),x),[])})}),e.jsx(C.Item,{paddingTop:6,paddingBottom:6,col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx(Te,{})}),e.jsx(C.Item,{col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx(k,{variant:"delta",tag:"h3",children:p({id:u("containers.SettingPage.view"),defaultMessage:"View"})})}),e.jsx(C.Item,{col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx(We,{attributes:t,components:l,fieldSizes:a,metadatas:I})})]})]})})]})})})},Ke=t=>t.flat(1),Ue=t=>t.map(a=>a.map(s=>({...s,mainField:s.mainField?.name}))),Ge=t=>t.map(a=>a.map(({label:s,disabled:o,hint:l,placeholder:c,size:g,name:I,mainField:p})=>({label:s,editable:!o,description:l,mainField:p,placeholder:c,size:g,name:I,__temp_key__:""}))),qe=t=>[...t.map(a=>{const s=a.reduce((o,l)=>o+l.size,0);return s<12?[...a,{name:R,size:12-s,__temp_key__:""}]:a})],Ye=t=>{const a=Y(void 0,void 0,t.length);return t.map((s,o)=>{const l=Y(void 0,void 0,s.length);return{__temp_key__:a[o],children:s.map((c,g)=>({...c,__temp_key__:l[g]}))}})},Je=({name:t})=>{const{formatMessage:a}=B(),s=w("Header",l=>l.modified),o=w("Header",l=>l.isSubmitting);return e.jsx(J.Header,{title:a({id:u("components.SettingsViewWrapper.pluginHeader.title"),defaultMessage:"Configure the view - {name}"},{name:ie(t)}),subtitle:a({id:u("components.SettingsViewWrapper.pluginHeader.description.edit-settings"),defaultMessage:"Customize how the edit view will look like."}),navigationAction:e.jsx(Re,{}),primaryAction:e.jsx(G,{disabled:!s,loading:o,type:"submit",children:a({id:"global.save",defaultMessage:"Save"})})})};export{nt as C,R as T};
