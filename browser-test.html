<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hebrew Translation Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .console-log { background: #f5f5f5; padding: 10px; margin: 5px 0; font-family: monospace; }
        .translation-item { margin: 5px 0; padding: 5px; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Hebrew Translation Debug Test</h1>
    
    <div class="test-section">
        <h2>1. Test Elements</h2>
        <div id="monthly-tab" data-i18n="pricing.content.plans.monthly.name">Monthly</div>
        <div id="yearly-tab" data-i18n="pricing.content.plans.annual.name">Yearly</div>
        <div id="hero-title" data-i18n="pricing.content.hero.title">Pricing Plan</div>
        <div id="explore-button" data-i18n="misc.content.explore_plans">Explore Plans Features</div>
    </div>

    <div class="test-section">
        <h2>2. Language Controls</h2>
        <button onclick="testEnglish()">Test English</button>
        <button onclick="testHebrew()">Test Hebrew</button>
        <button onclick="testAPI()">Test API Direct</button>
        <button onclick="testLanguageManager()">Test Language Manager</button>
    </div>

    <div class="test-section">
        <h2>3. Console Output</h2>
        <div id="console-output"></div>
    </div>

    <div class="test-section">
        <h2>4. Translation Results</h2>
        <div id="translation-results"></div>
    </div>

    <script>
        // Console capture
        const consoleOutput = document.getElementById('console-output');
        const originalConsoleLog = console.log;
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const logDiv = document.createElement('div');
            logDiv.className = 'console-log';
            logDiv.textContent = args.join(' ');
            consoleOutput.appendChild(logDiv);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // Initialize
        console.log('🔍 Debug test initialized');

        // Test functions
        async function testAPI() {
            console.log('🌐 Testing API direct call...');
            try {
                const response = await fetch('http://localhost:3000/api/nd/pricing-page?locale=he');
                const data = await response.json();
                console.log('✅ API Response received:', JSON.stringify(data, null, 2));
                
                if (data.success && data.data.attributes.sections.plans) {
                    const monthlyName = data.data.attributes.sections.plans.plans.monthly.name;
                    const yearlyName = data.data.attributes.sections.plans.plans.annual.name;
                    
                    console.log(`Monthly name from API: ${monthlyName}`);
                    console.log(`Yearly name from API: ${yearlyName}`);
                    
                    displayTranslationResult('API Direct', {
                        'monthly': monthlyName,
                        'yearly': yearlyName
                    });
                }
            } catch (error) {
                console.log('❌ API test failed:', error.message);
            }
        }

        async function testLanguageManager() {
            console.log('🔄 Testing Language Manager...');
            
            // Check if language manager is available
            if (typeof LanguageManager === 'undefined') {
                console.log('❌ LanguageManager not loaded');
                return;
            }

            try {
                const languageManager = new LanguageManager();
                console.log('✅ Language Manager created');
                
                // Wait a moment for initialization
                setTimeout(() => {
                    languageManager.switchLanguage('he');
                    console.log('🔄 Switched to Hebrew via Language Manager');
                    
                    setTimeout(() => {
                        checkElementTranslations();
                    }, 2000);
                }, 1000);
                
            } catch (error) {
                console.log('❌ Language Manager test failed:', error.message);
            }
        }

        function testEnglish() {
            console.log('🔄 Testing English...');
            updateElementsManually({
                'monthly-tab': 'Monthly',
                'yearly-tab': 'Yearly', 
                'hero-title': 'Pricing Plan',
                'explore-button': 'Explore Plans Features'
            });
            displayTranslationResult('English Manual', {
                'monthly': 'Monthly',
                'yearly': 'Yearly'
            });
        }

        function testHebrew() {
            console.log('🔄 Testing Hebrew...');
            updateElementsManually({
                'monthly-tab': 'חודשי',
                'yearly-tab': 'שנתי',
                'hero-title': 'בחר את מסלול הלמידה שלך',
                'explore-button': 'גלה את תכונות החבילות'
            });
            
            // Apply RTL
            document.documentElement.setAttribute('dir', 'rtl');
            document.documentElement.setAttribute('lang', 'he');
            
            displayTranslationResult('Hebrew Manual', {
                'monthly': 'חודשי',
                'yearly': 'שנתי'
            });
        }

        function updateElementsManually(translations) {
            Object.keys(translations).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = translations[id];
                    console.log(`Updated ${id}: ${translations[id]}`);
                }
            });
        }

        function checkElementTranslations() {
            const elements = [
                { id: 'monthly-tab', key: 'pricing.content.plans.monthly.name' },
                { id: 'yearly-tab', key: 'pricing.content.plans.annual.name' },
                { id: 'hero-title', key: 'pricing.content.hero.title' },
                { id: 'explore-button', key: 'misc.content.explore_plans' }
            ];

            const results = {};
            elements.forEach(({ id, key }) => {
                const element = document.getElementById(id);
                if (element) {
                    results[id] = {
                        key: key,
                        text: element.textContent,
                        hasDataI18n: element.hasAttribute('data-i18n')
                    };
                    console.log(`${id}: "${element.textContent}" (has data-i18n: ${element.hasAttribute('data-i18n')})`);
                }
            });

            displayTranslationResult('Current State', results);
        }

        function displayTranslationResult(testName, results) {
            const resultsDiv = document.getElementById('translation-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'translation-item';
            
            let html = `<strong>${testName}:</strong><br>`;
            Object.keys(results).forEach(key => {
                if (typeof results[key] === 'string') {
                    html += `${key}: ${results[key]}<br>`;
                } else {
                    html += `${key}: ${JSON.stringify(results[key])}<br>`;
                }
            });
            
            resultDiv.innerHTML = html;
            resultsDiv.appendChild(resultDiv);
        }

        // Auto-check on load
        setTimeout(() => {
            checkElementTranslations();
        }, 1000);
    </script>

    <!-- Load the actual language manager for testing -->
    <script src="http://localhost:3005/js/unified-language-manager.js"></script>
</body>
</html>
